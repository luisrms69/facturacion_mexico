{"config":{"lang":["es"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Facturaci\u00f3n M\u00e9xico - Documentaci\u00f3n T\u00e9cnica","text":"<p>Sistema integral de facturaci\u00f3n electr\u00f3nica para M\u00e9xico con soporte multi-sucursal y addendas din\u00e1micas</p>"},{"location":"#caracteristicas-principales","title":"Caracter\u00edsticas Principales","text":"<ul> <li>\u2705 Timbrado CFDI 4.0 - Integraci\u00f3n completa con PACs certificados</li> <li>\u2705 Multi-sucursal - Gesti\u00f3n de m\u00faltiples branches con coordinaci\u00f3n autom\u00e1tica  </li> <li>\u2705 Addendas Din\u00e1micas - Generaci\u00f3n autom\u00e1tica seg\u00fan cliente/proveedor</li> <li>\u2705 Catalogos SAT - Sincronizaci\u00f3n completa y actualizada</li> <li>\u2705 Production Ready - 46 tests automatizados con 100% de \u00e9xito</li> </ul>"},{"location":"#inicio-rapido","title":"Inicio R\u00e1pido","text":""},{"location":"#instalacion","title":"Instalaci\u00f3n","text":"<pre><code># 1. Instalar la app\nbench get-app facturacion_mexico\nbench --site tu-sitio.local install-app facturacion_mexico\n\n# 2. Configurar certificados\nbench --site tu-sitio.local execute facturacion_mexico.setup.configure_certificates\n\n# 3. Sincronizar catalogos SAT\nbench --site tu-sitio.local execute facturacion_mexico.setup.sync_sat_catalogs\n</code></pre>"},{"location":"#configuracion-basica","title":"Configuraci\u00f3n B\u00e1sica","text":"<pre><code># Site Config\n{\n    \"pac_provider\": \"finkok\",\n    \"pac_username\": \"tu_usuario\", \n    \"pac_password\": \"tu_password\",\n    \"multisucursal_enabled\": 1,\n    \"addendas_auto_generation\": 1\n}\n</code></pre>"},{"location":"#guias-de-documentacion","title":"Gu\u00edas de Documentaci\u00f3n","text":"<ul> <li>Gu\u00eda de Usuario - Aprende a usar el sistema</li> <li>API Reference - Documentaci\u00f3n t\u00e9cnica completa</li> <li>Desarrollo - Setup y contribuciones</li> </ul>"},{"location":"#metricas-del-proyecto","title":"M\u00e9tricas del Proyecto","text":"M\u00e9trica Valor Estado Tests Automatizados 46/46 \u2705 100% Cobertura Docstrings 90.1% \u2705 Excelente Compatibilidad SAT CFDI 4.0 \u2705 Actualizado Production Ready Sprint 6 \u2705 Alpha <p>Versi\u00f3n: Sprint 6 Alpha - Production Ready Framework: Frappe v15 \u00daltima actualizaci\u00f3n: 2025-07-25</p>"},{"location":"api/","title":"API Reference - Facturaci\u00f3n M\u00e9xico","text":"<p>Documentaci\u00f3n t\u00e9cnica completa de las APIs y funciones del sistema.</p>"},{"location":"api/#modulos-principales","title":"M\u00f3dulos Principales","text":""},{"location":"api/#cfdi","title":"CFDI","text":"<p>Funciones para generaci\u00f3n y timbrado de documentos fiscales.</p>"},{"location":"api/#multi-sucursal","title":"Multi-sucursal","text":"<p>APIs para gesti\u00f3n de m\u00faltiples branches y coordinaci\u00f3n.</p>"},{"location":"api/#addendas","title":"Addendas","text":"<p>Generaci\u00f3n din\u00e1mica de addendas seg\u00fan reglas de negocio.</p>"},{"location":"api/#catalogos-sat","title":"Catalogos SAT","text":"<p>Sincronizaci\u00f3n y gesti\u00f3n de catalogos oficiales del SAT.</p>"},{"location":"api/#hooks","title":"Hooks","text":"<p>Integraciones con ERPNext y validaciones autom\u00e1ticas.</p> <p>Auto-generaci\u00f3n</p> <p>Esta documentaci\u00f3n se genera autom\u00e1ticamente desde los docstrings del c\u00f3digo fuente.</p>"},{"location":"api/addendas/","title":"Addendas - Generaci\u00f3n Din\u00e1mica","text":"<p>Sistema avanzado de generaci\u00f3n autom\u00e1tica de addendas seg\u00fan reglas de negocio espec\u00edficas por cliente.</p>"},{"location":"api/addendas/#arquitectura-de-addendas","title":"Arquitectura de Addendas","text":""},{"location":"api/addendas/#concepto-general","title":"Concepto General","text":"<p>Las addendas son documentos XML adicionales que se anexan al CFDI para cumplir con requisitos espec\u00edficos de clientes corporativos como Walmart, Liverpool, Chedraui, etc.</p>"},{"location":"api/addendas/#caracteristicas-del-sistema","title":"Caracter\u00edsticas del Sistema:","text":"<ul> <li>Generaci\u00f3n din\u00e1mica basada en templates configurables</li> <li>Validaci\u00f3n autom\u00e1tica de formato y contenido</li> <li>Multi-formato (XML, JSON, EDI)</li> <li>Integraci\u00f3n seamless con el proceso de timbrado</li> </ul>"},{"location":"api/addendas/#tipos-de-addenda-soportados","title":"Tipos de Addenda Soportados","text":""},{"location":"api/addendas/#retail-chains-cadenas-comerciales","title":"Retail Chains (Cadenas Comerciales)","text":"<pre><code>ADDENDA_TYPES = {\n    \"WALMART_MX\": {\n        \"template\": \"walmart_mx.xml\",\n        \"required_fields\": [\"purchase_order\", \"vendor_number\", \"store_number\"],\n        \"validation_rules\": {\"purchase_order\": r\"^\\d{10}$\"},\n        \"auto_apply\": True\n    },\n    \"LIVERPOOL_MX\": {\n        \"template\": \"liverpool_mx.xml\", \n        \"required_fields\": [\"proveedor_id\", \"num_pedido\", \"sucursal\"],\n        \"validation_rules\": {\"proveedor_id\": r\"^LIV\\d{6}$\"},\n        \"auto_apply\": True\n    },\n    \"CHEDRAUI_MX\": {\n        \"template\": \"chedraui_mx.xml\",\n        \"required_fields\": [\"codigo_proveedor\", \"orden_compra\"],\n        \"validation_rules\": {\"codigo_proveedor\": r\"^CHE\\d{5}$\"},\n        \"auto_apply\": False  # Manual approval required\n    }\n}\n</code></pre>"},{"location":"api/addendas/#tests-de-validacion","title":"Tests de Validaci\u00f3n","text":""},{"location":"api/addendas/#end-to-end-validation-workflows","title":"End-to-End Validation Workflows","text":"<p>Pruebas completas de validaci\u00f3n de addendas desde generaci\u00f3n hasta aplicaci\u00f3n.</p>"},{"location":"api/addendas/#testaddendavalidatione2e","title":"<code>TestAddendaValidationE2E</code>","text":"<p>Test Cases Principales:</p>"},{"location":"api/addendas/#test_walmart_addenda_generation","title":"<code>test_walmart_addenda_generation()</code>","text":"<pre><code>def test_walmart_addenda_generation():\n    \"\"\"\n    Prueba generaci\u00f3n completa de addenda Walmart.\n\n    Proceso:\n    1. Crear Sales Invoice con datos Walmart\n    2. Aplicar template de addenda autom\u00e1ticamente  \n    3. Validar estructura XML generada\n    4. Verificar campos obligatorios\n    5. Confirmar integraci\u00f3n con CFDI\n    \"\"\"\n    # Datos de prueba Walmart\n    invoice_data = {\n        \"customer\": \"Walmart de M\u00e9xico\",\n        \"purchase_order\": \"1234567890\",\n        \"vendor_number\": \"WAL001234\",\n        \"store_number\": \"2587\"\n    }\n\n    # Generar addenda\n    addenda_xml = generate_addenda(invoice_data, \"WALMART_MX\")\n\n    # Validaciones\n    assert_xml_structure_valid(addenda_xml)\n    assert_required_fields_present(addenda_xml, WALMART_REQUIRED_FIELDS)\n</code></pre>"},{"location":"api/addendas/#test_dynamic_field_mapping","title":"<code>test_dynamic_field_mapping()</code>","text":"<pre><code>def test_dynamic_field_mapping():\n    \"\"\"\n    Prueba el mapeo din\u00e1mico de campos seg\u00fan el tipo de cliente.\n\n    Escenarios:\n    - Mapeo autom\u00e1tico por c\u00f3digo de cliente\n    - Override manual de mappings\n    - Validaci\u00f3n de campos requeridos\n    - Handling de campos opcionales\n    \"\"\"\n    # Test con diferentes tipos de clientes\n    for customer_type in [\"WALMART\", \"LIVERPOOL\", \"CHEDRAUI\"]:\n        mapping = get_dynamic_field_mapping(customer_type)\n        assert validate_mapping_completeness(mapping)\n</code></pre>"},{"location":"api/addendas/#multi-sucursal-con-addendas","title":"Multi-sucursal con Addendas","text":"<p>Pruebas de generaci\u00f3n de addendas en entorno multi-sucursal.</p>"},{"location":"api/addendas/#testaddendamultisucursalworkflows","title":"<code>TestAddendaMultisucursalWorkflows</code>","text":"<p>Test Cases:</p>"},{"location":"api/addendas/#test_branch_specific_addenda_rules","title":"<code>test_branch_specific_addenda_rules()</code>","text":"<pre><code>def test_branch_specific_addenda_rules():\n    \"\"\"\n    Prueba reglas espec\u00edficas de addenda por branch.\n\n    Casos:\n    - Addendas diferentes por sucursal del mismo cliente\n    - Priorizaci\u00f3n de reglas por geograf\u00eda\n    - Fallback a reglas generales\n    \"\"\"\n    branches = [\"NORTE_01\", \"SUR_01\", \"CENTRO_01\"]\n\n    for branch in branches:\n        rules = get_addenda_rules_for_branch(branch, \"WALMART_MX\")\n        assert validate_branch_specific_rules(rules, branch)\n</code></pre>"},{"location":"api/addendas/#test_coordinated_addenda_generation","title":"<code>test_coordinated_addenda_generation()</code>","text":"<pre><code>def test_coordinated_addenda_generation():\n    \"\"\"\n    Prueba coordinaci\u00f3n de generaci\u00f3n entre m\u00faltiples branches.\n\n    Escenarios:\n    - Generaci\u00f3n paralela en m\u00faltiples sucursales\n    - Sincronizaci\u00f3n de templates actualizados\n    - Manejo de conflicts en reglas\n    \"\"\"\n    # Coordinaci\u00f3n multi-branch\n    results = coordinate_addenda_generation(\n        branches=[\"SUC_A\", \"SUC_B\", \"SUC_C\"],\n        customer=\"WALMART_MX\",\n        invoice_batch=[...]\n    )\n\n    assert all_branches_synchronized(results)\n</code></pre>"},{"location":"api/addendas/#tests-de-stress","title":"Tests de Stress","text":""},{"location":"api/addendas/#addendas-stress-testing","title":"Addendas Stress Testing","text":"<p>Pruebas de rendimiento y resistencia del sistema de addendas.</p>"},{"location":"api/addendas/#testaddendastresstesting","title":"<code>TestAddendaStressTesting</code>","text":"<p>Test Cases de Carga:</p>"},{"location":"api/addendas/#test_massive_concurrent_addenda_generation","title":"<code>test_massive_concurrent_addenda_generation()</code>","text":"<pre><code>def test_massive_concurrent_addenda_generation():\n    \"\"\"\n    Prueba generaci\u00f3n masiva concurrente de addendas.\n\n    Par\u00e1metros de Stress:\n    - 1000+ addendas simult\u00e1neas\n    - 10+ tipos diferentes de templates\n    - 5+ branches coordinados\n    - 30 segundos de duraci\u00f3n sostenida\n    \"\"\"\n    concurrent_requests = 1000\n    addenda_types = [\"WALMART\", \"LIVERPOOL\", \"CHEDRAUI\", \"SORIANA\", \"OXXO\"]\n\n    with ThreadPoolExecutor(max_workers=50) as executor:\n        futures = []\n        for i in range(concurrent_requests):\n            addenda_type = random.choice(addenda_types)\n            future = executor.submit(generate_addenda_stress, addenda_type, i)\n            futures.append(future)\n\n        # Validar resultados\n        results = [f.result() for f in futures]\n        success_rate = sum(1 for r in results if r[\"success\"]) / len(results)\n\n        assert success_rate &gt;= 0.95  # 95% minimum success rate\n</code></pre>"},{"location":"api/addendas/#test_template_hot_swapping","title":"<code>test_template_hot_swapping()</code>","text":"<pre><code>def test_template_hot_swapping():\n    \"\"\"\n    Prueba intercambio de templates en caliente durante operaci\u00f3n.\n\n    Proceso:\n    1. Iniciar generaci\u00f3n continua de addendas\n    2. Actualizar templates durante operaci\u00f3n\n    3. Verificar transici\u00f3n sin interrupciones\n    4. Validar consistency de documentos generados\n    \"\"\"\n    # Generaci\u00f3n continua en background\n    with continuous_addenda_generation():\n        # Hot swap de templates\n        for template_version in [\"v1.0\", \"v1.1\", \"v1.2\"]:\n            update_template_version(\"WALMART_MX\", template_version) \n            time.sleep(10)  # Permitir transici\u00f3n\n\n            # Validar consistency\n            recent_addendas = get_recent_addendas(last_minutes=1)\n            assert all_addendas_valid(recent_addendas)\n</code></pre>"},{"location":"api/addendas/#algoritmos-de-generacion","title":"Algoritmos de Generaci\u00f3n","text":""},{"location":"api/addendas/#template-engine","title":"Template Engine","text":""},{"location":"api/addendas/#sistema-de-plantillas","title":"Sistema de Plantillas","text":"<pre><code>class AddendaTemplateEngine:\n    \"\"\"\n    Motor de plantillas para generaci\u00f3n din\u00e1mica de addendas.\n\n    Caracter\u00edsticas:\n    - Jinja2-based templating\n    - Custom filters for SAT compliance\n    - Multi-language support (ES/EN)\n    - Hot-reloading de templates\n    \"\"\"\n\n    def __init__(self, template_path: str):\n        self.template_path = template_path\n        self.jinja_env = Environment(\n            loader=FileSystemLoader(template_path),\n            autoescape=select_autoescape(['xml', 'html'])\n        )\n\n        # Custom filters\n        self.jinja_env.filters['sat_datetime'] = self._format_sat_datetime\n        self.jinja_env.filters['rfc_format'] = self._format_rfc\n\n    def generate_addenda(self, template_name: str, context: dict) -&gt; str:\n        \"\"\"\n        Genera addenda usando template y contexto dados.\n\n        Args:\n            template_name: Nombre del template (ej: 'walmart_mx.xml')\n            context: Datos para renderizar el template\n\n        Returns:\n            XML string de la addenda generada\n        \"\"\"\n        template = self.jinja_env.get_template(template_name)\n        return template.render(**context)\n</code></pre>"},{"location":"api/addendas/#validation-engine","title":"Validation Engine","text":""},{"location":"api/addendas/#sistema-de-validacion","title":"Sistema de Validaci\u00f3n","text":"<pre><code>class AddendaValidator:\n    \"\"\"\n    Validador completo de addendas generadas.\n\n    Validaciones:\n    - XML structure compliance\n    - SAT catalog consistency  \n    - Client-specific business rules\n    - Character encoding (UTF-8)\n    \"\"\"\n\n    def validate_addenda(self, addenda_xml: str, addenda_type: str) -&gt; ValidationResult:\n        \"\"\"\n        Valida una addenda generada contra todas las reglas aplicables.\n\n        Args:\n            addenda_xml: XML de la addenda a validar\n            addenda_type: Tipo de addenda (WALMART_MX, etc.)\n\n        Returns:\n            ValidationResult con detalles de la validaci\u00f3n\n        \"\"\"\n        result = ValidationResult()\n\n        # 1. XML structure validation\n        result.merge(self._validate_xml_structure(addenda_xml))\n\n        # 2. SAT compliance validation  \n        result.merge(self._validate_sat_compliance(addenda_xml))\n\n        # 3. Client-specific rules\n        result.merge(self._validate_client_rules(addenda_xml, addenda_type))\n\n        return result\n</code></pre>"},{"location":"api/addendas/#configuracion-avanzada","title":"Configuraci\u00f3n Avanzada","text":""},{"location":"api/addendas/#custom-templates","title":"Custom Templates","text":"<p>Para crear templates personalizados:</p> <pre><code>&lt;!-- walmart_mx.xml template --&gt;\n&lt;cfdi:Addenda&gt;\n    &lt;Walmart&gt;\n        &lt;requestForPayment&gt;\n            &lt;PaymentTerms&gt;{{ payment_terms | default('NET30') }}&lt;/PaymentTerms&gt;\n            &lt;InvoiceNumber&gt;{{ invoice_number }}&lt;/InvoiceNumber&gt;\n            &lt;PurchaseOrder&gt;{{ purchase_order | rfc_format }}&lt;/PurchaseOrder&gt;\n            &lt;VendorNumber&gt;{{ vendor_number }}&lt;/VendorNumber&gt;\n            &lt;StoreNumber&gt;{{ store_number }}&lt;/StoreNumber&gt;\n            &lt;InvoiceDate&gt;{{ invoice_date | sat_datetime }}&lt;/InvoiceDate&gt;\n        &lt;/requestForPayment&gt;\n    &lt;/Walmart&gt;\n&lt;/cfdi:Addenda&gt;\n</code></pre>"},{"location":"api/addendas/#business-rules","title":"Business Rules","text":"<pre><code>BUSINESS_RULES = {\n    \"WALMART_MX\": {\n        \"required_fields\": [\"purchase_order\", \"vendor_number\", \"store_number\"],\n        \"format_validations\": {\n            \"purchase_order\": r\"^\\d{10}$\",\n            \"vendor_number\": r\"^WAL\\d{6}$\", \n            \"store_number\": r\"^\\d{4}$\"\n        },\n        \"auto_apply_conditions\": [\n            \"customer.customer_name LIKE '%Walmart%'\",\n            \"customer.tax_id LIKE 'WMT%'\"\n        ]\n    }\n}\n</code></pre> <p>Production Ready</p> <p>El sistema de addendas ha pasado todas las pruebas de stress con 95%+ de tasa de \u00e9xito bajo carga m\u00e1xima.</p> <p>Extensibilidad</p> <p>Nuevos tipos de addenda se pueden agregar f\u00e1cilmente creando templates XML y definiendo reglas de validaci\u00f3n espec\u00edficas.</p>"},{"location":"api/catalogos/","title":"Catalogos SAT - Sincronizaci\u00f3n y Gesti\u00f3n","text":"<p>Documentaci\u00f3n de las funciones para sincronizaci\u00f3n y gesti\u00f3n de catalogos oficiales del SAT.</p>"},{"location":"api/catalogos/#doctypes-de-catalogos","title":"DocTypes de Catalogos","text":""},{"location":"api/catalogos/#regimen-fiscal-sat","title":"R\u00e9gimen Fiscal SAT","text":"<p>::: facturacion_mexico.catalogos_sat.doctype.regimen_fiscal_sat.regimen_fiscal_sat     options:       show_source: true       show_root_heading: true       show_root_toc_entry: false       docstring_style: google</p>"},{"location":"api/catalogos/#moneda-sat","title":"Moneda SAT","text":"<p>::: facturacion_mexico.catalogos_sat.doctype.moneda_sat.moneda_sat     options:       show_source: true       show_root_heading: true       show_root_toc_entry: false       docstring_style: google</p>"},{"location":"api/catalogos/#forma-de-pago-sat","title":"Forma de Pago SAT","text":"<p>::: facturacion_mexico.catalogos_sat.doctype.forma_pago_sat.forma_pago_sat     options:       show_source: true       show_root_heading: true       show_root_toc_entry: false       docstring_style: google</p>"},{"location":"api/catalogos/#reportes-de-analisis","title":"Reportes de An\u00e1lisis","text":""},{"location":"api/catalogos/#analisis-uom-sat","title":"An\u00e1lisis UOM SAT","text":"<p>::: facturacion_mexico.uom_sat.report.analisis_uom_sat.analisis_uom_sat     options:       show_source: false       show_root_heading: true       show_root_toc_entry: false       docstring_style: google       filters:         - \"!^_\"</p>"},{"location":"api/cfdi/","title":"CFDI - Timbrado y Validaci\u00f3n","text":"<p>Documentaci\u00f3n de las funciones principales para generaci\u00f3n y timbrado de CFDI 4.0.</p>"},{"location":"api/cfdi/#hooks-de-sales-invoice","title":"Hooks de Sales Invoice","text":""},{"location":"api/cfdi/#sales-invoice-submit-handler","title":"Sales Invoice Submit Handler","text":"<p>El handler principal para procesamiento de addendas durante submit de Sales Invoice.</p>"},{"location":"api/cfdi/#sales_invoice_on_submitdoc-method","title":"<code>sales_invoice_on_submit(doc, method)</code>","text":"<p>Hook handler que se ejecuta despu\u00e9s de que la factura es enviada exitosamente.</p> <p>Par\u00e1metros: - <code>doc</code> (Document): Documento Sales Invoice - <code>method</code> (str): M\u00e9todo de hook ('on_submit')</p> <p>Flujo de Procesamiento: 1. Verifica si debe procesar addenda con <code>should_process_addenda_on_submit()</code> 2. Procesa addenda despu\u00e9s del submit con <code>process_addenda_after_submit()</code> 3. Maneja errores sin interrumpir el flujo principal</p> <p>C\u00f3digo: <pre><code>def sales_invoice_on_submit(doc, method):\n    try:\n        if not should_process_addenda_on_submit(doc):\n            return\n        process_addenda_after_submit(doc)\n    except Exception as e:\n        frappe.log_error(f\"Error procesando addenda en submit de {doc.name}: {e!s}\")\n</code></pre></p>"},{"location":"api/cfdi/#should_process_addenda_on_submitdoc-bool","title":"<code>should_process_addenda_on_submit(doc) -&gt; bool</code>","text":"<p>Determina si se debe procesar addenda durante el submit.</p> <p>Par\u00e1metros: - <code>doc</code> (Document): Documento Sales Invoice</p> <p>Retorna: - <code>bool</code>: True si debe procesar addenda, False en caso contrario</p> <p>L\u00f3gica de Validaci\u00f3n: 1. Verifica si <code>fm_addenda_required</code> est\u00e1 activado 2. Obtiene configuraci\u00f3n de addenda del cliente 3. Valida si <code>auto_apply</code> est\u00e1 habilitado</p>"},{"location":"api/cfdi/#sales-invoice-validate-handler","title":"Sales Invoice Validate Handler","text":"<p>Handler para validaciones durante la validaci\u00f3n de Sales Invoice.</p>"},{"location":"api/cfdi/#instalacion-y-setup","title":"Instalaci\u00f3n y Setup","text":""},{"location":"api/cfdi/#funciones-de-instalacion","title":"Funciones de Instalaci\u00f3n","text":""},{"location":"api/cfdi/#before_tests","title":"<code>before_tests()</code>","text":"<p>Configura el entorno para pruebas automatizadas.</p> <p>Funcionalidades: - Crea datos b\u00e1sicos de prueba - Configura catalogos SAT m\u00ednimos - Establece configuraci\u00f3n de company b\u00e1sica - Crea warehouse types y UOMs necesarios</p>"},{"location":"api/cfdi/#_create_basic_addenda_types","title":"<code>_create_basic_addenda_types()</code>","text":"<p>Crea tipos de addenda b\u00e1sicos para el sistema.</p> <p>Tipos Creados: - WALMART_MX: Addenda para Walmart M\u00e9xico - LIVERPOOL_MX: Addenda para Liverpool - CHEDRAUI_MX: Addenda para Chedraui - SORIANA_MX: Addenda para Soriana</p> <p>Configuraci\u00f3n por Tipo: <pre><code>{\n    \"addenda_type\": \"WALMART_MX\",\n    \"template_path\": \"addendas/templates/walmart_mx.xml\",\n    \"validation_rules\": {...},\n    \"auto_apply\": True\n}\n</code></pre></p>"},{"location":"api/cfdi/#_create_basic_test_customers","title":"<code>_create_basic_test_customers()</code>","text":"<p>Crea clientes de prueba con configuraciones espec\u00edficas.</p> <p>Clientes de Prueba: - Walmart de M\u00e9xico: Con addenda autom\u00e1tica habilitada - Liverpool Sucursal: Con configuraci\u00f3n multi-sucursal - Chedraui Regional: Con validaciones espec\u00edficas</p>"},{"location":"api/cfdi/#_ensure_basic_erpnext_records","title":"<code>_ensure_basic_erpnext_records()</code>","text":"<p>Asegura que existan registros b\u00e1sicos de ERPNext necesarios.</p> <p>Registros Verificados: - Company con configuraci\u00f3n fiscal - Accounts con mapping SAT - Tax Categories b\u00e1sicas - Cost Centers por sucursal</p>"},{"location":"api/cfdi/#funciones-auxiliares","title":"Funciones Auxiliares","text":""},{"location":"api/cfdi/#validacion-de-documentos","title":"Validaci\u00f3n de Documentos","text":""},{"location":"api/cfdi/#validate_cfdi_requirementsdoc","title":"<code>validate_cfdi_requirements(doc)</code>","text":"<p>Valida que el documento cumpla con requisitos CFDI.</p> <p>Validaciones: - RFC v\u00e1lido del cliente - Datos fiscales completos - Items con c\u00f3digos SAT - Moneda y tipo de cambio v\u00e1lidos</p>"},{"location":"api/cfdi/#generacion-de-xml","title":"Generaci\u00f3n de XML","text":""},{"location":"api/cfdi/#generate_cfdi_xmldoc","title":"<code>generate_cfdi_xml(doc)</code>","text":"<p>Genera el XML CFDI 4.0 para el documento.</p> <p>Proceso: 1. Valida datos del documento 2. Aplica catalogos SAT 3. Genera estructura XML 4. Valida contra XSD oficial 5. Retorna XML listo para timbrado</p> <p>Integraci\u00f3n PAC</p> <p>El timbrado se realiza autom\u00e1ticamente tras la generaci\u00f3n del XML usando la configuraci\u00f3n PAC definida en Site Config.</p> <p>Validaciones</p> <p>Todas las funciones incluyen validaciones estrictas seg\u00fan normativas SAT para CFDI 4.0.</p>"},{"location":"api/hooks/","title":"Hooks - Integraciones ERPNext","text":"<p>Documentaci\u00f3n de hooks y validaciones autom\u00e1ticas integradas con ERPNext.</p>"},{"location":"api/hooks/#configuracion-de-hooks","title":"Configuraci\u00f3n de Hooks","text":"<p>::: facturacion_mexico.hooks     options:       show_source: true       show_root_heading: true       show_root_toc_entry: false       docstring_style: google</p>"},{"location":"api/hooks/#facturas-globales","title":"Facturas Globales","text":""},{"location":"api/hooks/#factura-global-mx","title":"Factura Global MX","text":"<p>::: facturacion_mexico.facturas_globales.doctype.factura_global_mx.factura_global_mx     options:       show_source: true       show_root_heading: true       show_root_toc_entry: false       docstring_style: google</p>"},{"location":"api/hooks/#procesadores","title":"Procesadores","text":""},{"location":"api/hooks/#cfdi-global-builder","title":"CFDI Global Builder","text":"<p>::: facturacion_mexico.facturas_globales.processors.cfdi_global_builder     options:       show_source: false       show_root_heading: true       show_root_toc_entry: false       docstring_style: google       filters:         - \"!^_\"</p>"},{"location":"api/hooks/#e-receipt-aggregator","title":"E-Receipt Aggregator","text":"<p>::: facturacion_mexico.facturas_globales.processors.ereceipt_aggregator     options:       show_source: false       show_root_heading: true       show_root_toc_entry: false       docstring_style: google       filters:         - \"!^_\"</p>"},{"location":"api/hooks/#apis-publicas","title":"APIs P\u00fablicas","text":"<p>::: facturacion_mexico.facturas_globales.api     options:       show_source: false       show_root_heading: true       show_root_toc_entry: false       docstring_style: google       filters:         - \"!^_\"</p>"},{"location":"api/multisucursal/","title":"Multi-sucursal - Gesti\u00f3n de Branches","text":"<p>Documentaci\u00f3n de las funciones para gesti\u00f3n multi-sucursal y coordinaci\u00f3n entre branches.</p>"},{"location":"api/multisucursal/#arquitectura-multi-sucursal","title":"Arquitectura Multi-sucursal","text":""},{"location":"api/multisucursal/#concepto-de-branches","title":"Concepto de Branches","text":"<p>El sistema multi-sucursal permite gestionar m\u00faltiples sucursales de una empresa con:</p> <ul> <li>Timbrado coordinado entre sucursales</li> <li>Selecci\u00f3n autom\u00e1tica de branch seg\u00fan cliente/ubicaci\u00f3n  </li> <li>Failover autom\u00e1tico en caso de fallas</li> <li>Load balancing para distribuci\u00f3n de carga</li> </ul>"},{"location":"api/multisucursal/#configuracion-de-branches","title":"Configuraci\u00f3n de Branches","text":""},{"location":"api/multisucursal/#estructura-de-branch","title":"Estructura de Branch","text":"<pre><code>{\n    \"branch_code\": \"SUCURSAL_01\",\n    \"branch_name\": \"Sucursal Centro\",\n    \"pac_provider\": \"finkok\",\n    \"pac_credentials\": {...},\n    \"is_primary\": True,\n    \"status\": \"active\",\n    \"coordination_group\": \"GRUPO_A\"\n}\n</code></pre>"},{"location":"api/multisucursal/#tests-de-integracion","title":"Tests de Integraci\u00f3n","text":""},{"location":"api/multisucursal/#branch-customer-selection-workflows","title":"Branch Customer Selection Workflows","text":"<p>Pruebas de selecci\u00f3n autom\u00e1tica de branch basada en cliente.</p>"},{"location":"api/multisucursal/#testbranchcustomerselection","title":"<code>TestBranchCustomerSelection</code>","text":"<p>Test Cases: - test_customer_branch_assignment: Asignaci\u00f3n autom\u00e1tica por cliente - test_geographic_branch_selection: Selecci\u00f3n por ubicaci\u00f3n geogr\u00e1fica - test_customer_preference_override: Override manual de preferencias - test_branch_capacity_management: Gesti\u00f3n de capacidad por branch</p>"},{"location":"api/multisucursal/#logica-de-seleccion","title":"L\u00f3gica de Selecci\u00f3n","text":"<pre><code>def select_branch_for_customer(customer_code, invoice_data):\n    \"\"\"\n    Selecciona el branch \u00f3ptimo para un cliente espec\u00edfico.\n\n    Criterios de selecci\u00f3n:\n    1. Preferencia expl\u00edcita del cliente\n    2. Ubicaci\u00f3n geogr\u00e1fica\n    3. Capacidad disponible del branch\n    4. Estado del PAC provider\n    \"\"\"\n    # Implementaci\u00f3n de algoritmo de selecci\u00f3n\n    pass\n</code></pre>"},{"location":"api/multisucursal/#cfdi-multi-sucursal-generation","title":"CFDI Multi-sucursal Generation","text":"<p>Pruebas de generaci\u00f3n coordinada de CFDI entre m\u00faltiples branches.</p>"},{"location":"api/multisucursal/#testcfdimultisucursalgeneration","title":"<code>TestCFDIMultisucursalGeneration</code>","text":"<p>Test Cases: - test_coordinated_cfdi_generation: Generaci\u00f3n coordinada - test_branch_failover_mechanism: Mecanismo de failover - test_pac_coordination: Coordinaci\u00f3n entre PACs - test_xml_sequence_management: Gesti\u00f3n de secuencias XML</p>"},{"location":"api/multisucursal/#proceso-de-coordinacion","title":"Proceso de Coordinaci\u00f3n","text":"<pre><code>def coordinate_cfdi_generation(branches, invoice_data):\n    \"\"\"\n    Coordina la generaci\u00f3n de CFDI entre m\u00faltiples branches.\n\n    Proceso:\n    1. Validar disponibilidad de branches\n    2. Seleccionar branch principal\n    3. Configurar branches de respaldo\n    4. Ejecutar generaci\u00f3n con failover\n    \"\"\"\n    # Implementaci\u00f3n de coordinaci\u00f3n\n    pass\n</code></pre>"},{"location":"api/multisucursal/#tests-de-produccion","title":"Tests de Producci\u00f3n","text":""},{"location":"api/multisucursal/#production-readiness-testing","title":"Production Readiness Testing","text":"<p>Pruebas de preparaci\u00f3n para producci\u00f3n del sistema multi-sucursal.</p>"},{"location":"api/multisucursal/#testmultisucursalproduction","title":"<code>TestMultisucursalProduction</code>","text":"<p>Test Cases: - test_high_volume_coordination: Coordinaci\u00f3n con alto volumen - test_branch_synchronization: Sincronizaci\u00f3n entre branches - test_pac_provider_failover: Failover de proveedores PAC - test_xml_validation_under_load: Validaci\u00f3n XML bajo carga</p>"},{"location":"api/multisucursal/#coordinacion-pac","title":"Coordinaci\u00f3n PAC","text":""},{"location":"api/multisucursal/#algoritmo-de-balanceo","title":"Algoritmo de Balanceo","text":"<pre><code>def balance_pac_load(branches, current_load):\n    \"\"\"\n    Distribuye la carga entre diferentes PAC providers.\n\n    Factores considerados:\n    1. Capacidad del PAC\n    2. Latencia de respuesta\n    3. Tasa de \u00e9xito hist\u00f3rica  \n    4. Costo por transacci\u00f3n\n    \"\"\"\n    # Implementaci\u00f3n de balanceador\n    pass\n</code></pre>"},{"location":"api/multisucursal/#manejo-de-failover","title":"Manejo de Failover","text":"<pre><code>def handle_pac_failover(primary_branch, backup_branches):\n    \"\"\"\n    Maneja el failover autom\u00e1tico entre branches.\n\n    Proceso:\n    1. Detectar falla en branch principal\n    2. Seleccionar branch de respaldo \u00f3ptimo\n    3. Transferir contexto de timbrado\n    4. Reanudar operaciones sin p\u00e9rdida\n    \"\"\"\n    # Implementaci\u00f3n de failover\n    pass\n</code></pre>"},{"location":"api/multisucursal/#metricas-y-monitoreo","title":"M\u00e9tricas y Monitoreo","text":""},{"location":"api/multisucursal/#kpis-del-sistema","title":"KPIs del Sistema","text":""},{"location":"api/multisucursal/#disponibilidad-por-branch","title":"Disponibilidad por Branch","text":"<pre><code>def calculate_branch_availability(branch_code, time_period):\n    \"\"\"\n    Calcula la disponibilidad de un branch espec\u00edfico.\n\n    M\u00e9tricas:\n    - Uptime percentage\n    - Response time promedio\n    - Tasa de \u00e9xito de timbrado\n    - Volumen procesado\n    \"\"\"\n    # C\u00e1lculo de m\u00e9tricas\n    pass\n</code></pre>"},{"location":"api/multisucursal/#coordinacion-global","title":"Coordinaci\u00f3n Global","text":"<pre><code>def monitor_global_coordination():\n    \"\"\"\n    Monitorea la coordinaci\u00f3n global del sistema.\n\n    Indicadores:\n    - Latencia de coordinaci\u00f3n\n    - Efectividad del failover\n    - Distribuci\u00f3n de carga\n    - Sincronizaci\u00f3n de datos\n    \"\"\"\n    # Monitoreo en tiempo real\n    pass\n</code></pre>"},{"location":"api/multisucursal/#configuracion-avanzada","title":"Configuraci\u00f3n Avanzada","text":""},{"location":"api/multisucursal/#branch-groups","title":"Branch Groups","text":"<p>Los branches se pueden agrupar para coordinaci\u00f3n espec\u00edfica:</p> <pre><code>BRANCH_GROUPS = {\n    \"GRUPO_NORTE\": [\"TIJUANA_01\", \"MONTERREY_01\", \"CHIHUAHUA_01\"],\n    \"GRUPO_SUR\": [\"CANCUN_01\", \"MERIDA_01\", \"VILLAHERMOSA_01\"],\n    \"GRUPO_CENTRO\": [\"MEXICO_01\", \"GUADALAJARA_01\", \"PUEBLA_01\"]\n}\n</code></pre>"},{"location":"api/multisucursal/#politicas-de-failover","title":"Pol\u00edticas de Failover","text":"<pre><code>FAILOVER_POLICIES = {\n    \"geographic_priority\": True,  # Priorizar branches geogr\u00e1ficamente cercanos\n    \"pac_diversity\": True,        # Usar diferentes PACs en failover\n    \"load_balancing\": True,       # Considerar carga actual\n    \"cost_optimization\": False    # Optimizar por costo vs velocidad\n}\n</code></pre> <p>Configuraci\u00f3n \u00d3ptima</p> <p>Para obtener el mejor rendimiento, configure al menos 3 branches por grupo de coordinaci\u00f3n con diferentes proveedores PAC.</p> <p>Sincronizaci\u00f3n</p> <p>La sincronizaci\u00f3n entre branches es cr\u00edtica. Asegure conectividad estable entre todas las sucursales.</p>"},{"location":"audit/critical_modules_analysis/","title":"\ud83d\udd0d An\u00e1lisis de M\u00f3dulos Cr\u00edticos - Priorizaci\u00f3n Documentaci\u00f3n","text":"<p>Fecha: 2025-07-25 Proyecto: Facturaci\u00f3n M\u00e9xico Fase: FASE 1 - Auditor\u00eda y Preparaci\u00f3n</p>"},{"location":"audit/critical_modules_analysis/#modulos-identificados-por-prioridad","title":"\ud83c\udfaf M\u00f3dulos Identificados por Prioridad","text":""},{"location":"audit/critical_modules_analysis/#prioridad-critica-must-document","title":"\ud83d\udd25 PRIORIDAD CR\u00cdTICA (Must Document)","text":""},{"location":"audit/critical_modules_analysis/#1-sistema-core","title":"1. Sistema Core","text":"<ul> <li><code>hooks.py</code> - Entry point, integraci\u00f3n Frappe</li> <li><code>install.py</code> - Setup y configuraci\u00f3n inicial  </li> <li><code>__init__.py</code> - Package definition</li> </ul>"},{"location":"audit/critical_modules_analysis/#2-cfdi-timbrado","title":"2. CFDI &amp; Timbrado","text":"<ul> <li><code>cfdi/</code> - Generaci\u00f3n de documentos fiscales</li> <li><code>timbrado/</code> - Integraci\u00f3n PAC y certificaci\u00f3n</li> <li><code>validation/</code> - Validaciones SAT</li> </ul>"},{"location":"audit/critical_modules_analysis/#3-multi-sucursal-sprint-6","title":"3. Multi-sucursal (Sprint 6)","text":"<ul> <li><code>multisucursal/</code> - Gesti\u00f3n de branches</li> <li><code>branch_selection/</code> - Selecci\u00f3n din\u00e1mica sucursales</li> <li><code>coordination/</code> - Coordinaci\u00f3n entre branches</li> </ul>"},{"location":"audit/critical_modules_analysis/#4-addendas-sprint-6","title":"4. Addendas (Sprint 6)","text":"<ul> <li><code>addendas/</code> - Generaci\u00f3n din\u00e1mica</li> <li><code>templates/</code> - Plantillas configurables</li> <li><code>validation/</code> - Validaci\u00f3n formato</li> </ul>"},{"location":"audit/critical_modules_analysis/#prioridad-alta-should-document","title":"\ud83d\udfe1 PRIORIDAD ALTA (Should Document)","text":""},{"location":"audit/critical_modules_analysis/#5-catalogos-sat","title":"5. Catalogos SAT","text":"<ul> <li><code>catalogos_sat/doctype/regimen_fiscal_sat/</code></li> <li><code>catalogos_sat/doctype/moneda_sat/</code> </li> <li><code>catalogos_sat/doctype/forma_pago_sat/</code></li> </ul>"},{"location":"audit/critical_modules_analysis/#6-facturas-globales","title":"6. Facturas Globales","text":"<ul> <li><code>facturas_globales/doctype/factura_global_mx/</code></li> <li><code>facturas_globales/processors/cfdi_global_builder.py</code></li> <li><code>facturas_globales/processors/ereceipt_aggregator.py</code></li> </ul>"},{"location":"audit/critical_modules_analysis/#7-hooks-handlers","title":"7. Hooks Handlers","text":"<ul> <li><code>hooks_handlers/sales_invoice_submit.py</code></li> <li><code>hooks_handlers/sales_invoice_validate.py</code></li> </ul>"},{"location":"audit/critical_modules_analysis/#prioridad-media-good-to-document","title":"\ud83d\udfe2 PRIORIDAD MEDIA (Good to Document)","text":""},{"location":"audit/critical_modules_analysis/#8-testing-framework","title":"8. Testing Framework","text":"<ul> <li><code>tests/test_layer3_*.py</code> - Integration tests</li> <li><code>tests/test_layer4_*.py</code> - Production tests  </li> </ul>"},{"location":"audit/critical_modules_analysis/#9-reports-analytics","title":"9. Reports &amp; Analytics","text":"<ul> <li><code>reports/</code> - Reportes especializados</li> <li><code>analytics/</code> - M\u00e9tricas y dashboards</li> </ul>"},{"location":"audit/critical_modules_analysis/#10-utilities-scripts","title":"10. Utilities &amp; Scripts","text":"<ul> <li><code>scripts/</code> - Herramientas desarrollo</li> <li><code>utilities/</code> - Funciones auxiliares</li> </ul>"},{"location":"audit/critical_modules_analysis/#analisis-tecnico-por-modulo","title":"\ud83d\udcca An\u00e1lisis T\u00e9cnico por M\u00f3dulo","text":""},{"location":"audit/critical_modules_analysis/#cobertura-actual-estimada","title":"Cobertura Actual Estimada","text":"M\u00f3dulo Files Docstring % Priority Effort Core (hooks, install) 3 60% \ud83d\udd25 Critical 2h CFDI/Timbrado 15+ 85% \ud83d\udd25 Critical 4h Multi-sucursal 10+ 90% \ud83d\udd25 Critical 3h Addendas 8+ 85% \ud83d\udd25 Critical 2h Catalogos SAT 20+ 95% \ud83d\udfe1 High 2h Facturas Globales 6+ 80% \ud83d\udfe1 High 1.5h Hooks Handlers 4 70% \ud83d\udfe1 High 1h Tests 35 90% \ud83d\udfe2 Medium 1h Reports 10+ 75% \ud83d\udfe2 Medium 1h Scripts/Utils 15+ 50% \ud83d\udfe2 Medium 1h <p>Total estimado: ~18.5 horas documentaci\u00f3n</p>"},{"location":"audit/critical_modules_analysis/#estrategia-de-documentacion","title":"\ud83c\udfaf Estrategia de Documentaci\u00f3n","text":""},{"location":"audit/critical_modules_analysis/#fase-2-setup-45-min","title":"FASE 2: Setup (45 min)","text":"<ul> <li>Configurar MkDocs Material</li> <li>Templates y estructura base</li> <li>Auto-generation setup</li> </ul>"},{"location":"audit/critical_modules_analysis/#fase-3-api-auto-gen-60-min","title":"FASE 3: API Auto-gen (60 min)","text":"<ul> <li>Generar docs desde docstrings existentes</li> <li>Configurar plugins y extensiones</li> <li>Preview y testing</li> </ul>"},{"location":"audit/critical_modules_analysis/#fase-4-manual-documentation-90-min","title":"FASE 4: Manual Documentation (90 min)","text":"<ul> <li>User guides y tutorials</li> <li>Code examples y samples  </li> <li>Navigation y search</li> </ul>"},{"location":"audit/critical_modules_analysis/#issues-criticos-identificados","title":"\ud83d\udd27 Issues Cr\u00edticos Identificados","text":""},{"location":"audit/critical_modules_analysis/#missing-docstrings-fix-first","title":"Missing Docstrings (Fix First)","text":"<ol> <li><code>hooks.py</code> - D100: Missing module docstring</li> <li><code>__init__.py</code> - D104: Missing package docstring  </li> <li>Core modules - Multiple D100 violations</li> </ol>"},{"location":"audit/critical_modules_analysis/#format-issues-fix-during","title":"Format Issues (Fix During)","text":"<ol> <li>D212: Multi-line summary start</li> <li>D415: Missing punctuation</li> <li>D202/D205: Spacing problems</li> </ol>"},{"location":"audit/critical_modules_analysis/#next-step-fase-2-setup","title":"\ud83d\udccb Next Step: FASE 2 Setup","text":"<p>Ready to proceed with MkDocs Material configuration and basic structure setup.</p> <p>Estimated completion FASE 1: \u2705 COMPLETED Next: FASE 2 - Configuraci\u00f3n MkDocs Material</p>"},{"location":"audit/docstring_coverage_report/","title":"\ud83d\udcca Reporte de Cobertura de Documentaci\u00f3n","text":"<p>Fecha: 2025-07-25 Proyecto: Facturaci\u00f3n M\u00e9xico Herramienta: interrogate + pydocstyle</p>"},{"location":"audit/docstring_coverage_report/#resumen-ejecutivo","title":"\ud83c\udfaf Resumen Ejecutivo","text":""},{"location":"audit/docstring_coverage_report/#estado-general","title":"\u2705 Estado General","text":"<ul> <li>Cobertura docstrings: 90.1% (\u2705 APROBADO - m\u00ednimo 80%)</li> <li>Badge generado: <code>docs/badges/interrogate_badge.svg</code></li> <li>Estado: BUENO - Por encima del umbral m\u00ednimo</li> </ul>"},{"location":"audit/docstring_coverage_report/#metricas-clave","title":"\ud83d\udcc8 M\u00e9tricas Clave","text":"<ul> <li>Archivos Python analizados: ~150+ archivos</li> <li>Funciones documentadas: 90.1%</li> <li>M\u00f3dulos con docstrings faltantes: Identificados</li> <li>Errores de estilo: 1,520 issues detectados</li> </ul>"},{"location":"audit/docstring_coverage_report/#analisis-detallado","title":"\ud83d\udd0d An\u00e1lisis Detallado","text":""},{"location":"audit/docstring_coverage_report/#modulos-criticos-identificados","title":"\ud83d\udcc1 M\u00f3dulos Cr\u00edticos Identificados","text":"<ul> <li><code>facturacion_mexico/hooks.py</code> - Missing module docstring</li> <li><code>facturacion_mexico/__init__.py</code> - Missing package docstring  </li> <li><code>facturacion_mexico/install.py</code> - Multiple docstring format issues</li> <li><code>scripts/</code> - Varios archivos con docstrings faltantes</li> </ul>"},{"location":"audit/docstring_coverage_report/#issues-principales-por-categoria","title":"\ud83d\udea8 Issues Principales por Categor\u00eda","text":""},{"location":"audit/docstring_coverage_report/#1-missing-docstrings-d100-d104","title":"1. Missing Docstrings (D100, D104)","text":"<ul> <li>M\u00f3dulos p\u00fablicos sin documentaci\u00f3n</li> <li>Paquetes sin documentaci\u00f3n inicial</li> </ul>"},{"location":"audit/docstring_coverage_report/#2-format-issues-d212-d205-d415","title":"2. Format Issues (D212, D205, D415)","text":"<ul> <li>Multi-line docstrings mal formateados</li> <li>Falta de l\u00edneas en blanco entre resumen y descripci\u00f3n</li> <li>Falta de puntuaci\u00f3n final en docstrings</li> </ul>"},{"location":"audit/docstring_coverage_report/#3-spacing-issues-d202","title":"3. Spacing Issues (D202)","text":"<ul> <li>L\u00edneas en blanco incorrectas despu\u00e9s de docstrings</li> </ul>"},{"location":"audit/docstring_coverage_report/#prioridades-para-documentacion","title":"\ud83d\udccb Prioridades para Documentaci\u00f3n","text":""},{"location":"audit/docstring_coverage_report/#alta-prioridad","title":"\ud83d\udd25 Alta Prioridad","text":"<ol> <li>M\u00f3dulos core: <code>hooks.py</code>, <code>install.py</code>, <code>__init__.py</code></li> <li>APIs p\u00fablicas: Funciones expuestas al usuario</li> <li>DocTypes principales: CFDI, Addendas, Multi-sucursal</li> </ol>"},{"location":"audit/docstring_coverage_report/#media-prioridad","title":"\ud83d\udfe1 Media Prioridad","text":"<ol> <li>Hooks handlers: Documentar funciones de validaci\u00f3n</li> <li>Utilities: Funciones auxiliares comunes</li> <li>Tests: Documentar casos de prueba complejos</li> </ol>"},{"location":"audit/docstring_coverage_report/#baja-prioridad","title":"\ud83d\udfe2 Baja Prioridad","text":"<ol> <li>Scripts auxiliares: Herramientas de desarrollo</li> <li>Migrations: Documentar cambios de versi\u00f3n</li> <li>Configuraciones: Archivos de setup</li> </ol>"},{"location":"audit/docstring_coverage_report/#objetivos-fase-2-4","title":"\ud83c\udfaf Objetivos FASE 2-4","text":""},{"location":"audit/docstring_coverage_report/#target-coverage-95","title":"Target Coverage: 95%+","text":"<ul> <li>Documentar todos los m\u00f3dulos p\u00fablicos</li> <li>Corregir issues de formato cr\u00edticos</li> <li>Generar documentaci\u00f3n API autom\u00e1tica</li> </ul>"},{"location":"audit/docstring_coverage_report/#quality-standards","title":"Quality Standards","text":"<ul> <li>Google-style docstrings consistentes</li> <li>Ejemplos de uso en funciones complejas</li> <li>Documentaci\u00f3n biling\u00fce (espa\u00f1ol para usuarios, ingl\u00e9s t\u00e9cnico)</li> </ul>"},{"location":"audit/quality_baseline/","title":"\ud83d\udcca L\u00ednea Base de Calidad - Proyecto Facturaci\u00f3n M\u00e9xico","text":"<p>Fecha Baseline: 2025-07-25 Versi\u00f3n: Sprint 6 Alpha - Post Layer 4 Tests Estado: Documentaci\u00f3n Profesional - FASE 1</p>"},{"location":"audit/quality_baseline/#metricas-generales-del-proyecto","title":"\ud83c\udfaf M\u00e9tricas Generales del Proyecto","text":""},{"location":"audit/quality_baseline/#estructura-del-codigo","title":"\ud83d\udcc1 Estructura del C\u00f3digo","text":"<ul> <li>Total archivos Python: 252 archivos</li> <li>Archivos de test: 35 archivos (13.9%)</li> <li>Cobertura tests: 46 tests Layer 3-4 exitosos (100%)</li> <li>M\u00f3dulos principales: 15+ m\u00f3dulos core</li> </ul>"},{"location":"audit/quality_baseline/#calidad-de-documentacion","title":"\ud83d\udcc8 Calidad de Documentaci\u00f3n","text":""},{"location":"audit/quality_baseline/#cobertura-docstrings","title":"Cobertura Docstrings","text":"<ul> <li>Actual: 90.1% \u2705</li> <li>Target: 95%+</li> <li>Badge: Generado en <code>docs/badges/</code></li> </ul>"},{"location":"audit/quality_baseline/#issues-de-estilo-pydocstyle","title":"Issues de Estilo (pydocstyle)","text":"<ul> <li>Total detectados: 1,520 issues</li> <li>Categor\u00edas principales:</li> <li>D212: Multi-line format (40%)</li> <li>D415: Punctuation missing (25%)</li> <li>D100/D104: Missing docstrings (20%)</li> <li>D202/D205: Spacing issues (15%)</li> </ul>"},{"location":"audit/quality_baseline/#arquitectura-del-sistema","title":"\ud83c\udfd7\ufe0f Arquitectura del Sistema","text":""},{"location":"audit/quality_baseline/#modulos-core-documentados","title":"M\u00f3dulos Core Documentados","text":"<ul> <li>\u2705 CFDI Generation: Timbrado y validaci\u00f3n</li> <li>\u2705 Multi-sucursal: Gesti\u00f3n de branches</li> <li>\u2705 Addendas: Generaci\u00f3n din\u00e1mica</li> <li>\u2705 Catalogos SAT: Integraci\u00f3n completa</li> <li>\u2705 Testing Framework: 46 tests implementados</li> </ul>"},{"location":"audit/quality_baseline/#apis-y-integraciones","title":"APIs y Integraciones","text":"<ul> <li>PAC Integration: Timbrado automatizado</li> <li>SAT Catalogs: Sincronizaci\u00f3n completa</li> <li>Frappe Framework: v15 compatible</li> <li>ERPNext Integration: Seamless</li> </ul>"},{"location":"audit/quality_baseline/#objetivos-de-mejora-fase-2-4","title":"\ud83c\udfaf Objetivos de Mejora (FASE 2-4)","text":""},{"location":"audit/quality_baseline/#documentacion-target","title":"\ud83d\udcda Documentaci\u00f3n Target","text":""},{"location":"audit/quality_baseline/#coverage-goals","title":"Coverage Goals","text":"<ul> <li>Docstrings: 90.1% \u2192 95%+</li> <li>API Documentation: Auto-generada</li> <li>User Guides: Manuales completos</li> <li>Developer Docs: Gu\u00edas t\u00e9cnicas</li> </ul>"},{"location":"audit/quality_baseline/#quality-standards","title":"Quality Standards","text":"<ul> <li>Google Style: Docstrings consistentes</li> <li>Biling\u00fce: Espa\u00f1ol (usuario) + Ingl\u00e9s (t\u00e9cnico)</li> <li>Ejemplos: Code samples en todas las APIs</li> <li>Navegaci\u00f3n: Search + categorizaci\u00f3n</li> </ul>"},{"location":"audit/quality_baseline/#technical-debt","title":"\ud83d\udd27 Technical Debt","text":""},{"location":"audit/quality_baseline/#high-priority-fixes","title":"High Priority Fixes","text":"<ol> <li>Missing module docstrings: hooks.py, init.py</li> <li>Format standardization: D212, D415 issues</li> <li>API documentation: Auto-generation setup</li> </ol>"},{"location":"audit/quality_baseline/#medium-priority","title":"Medium Priority","text":"<ol> <li>Code examples: Docstrings con samples</li> <li>User guides: Documentaci\u00f3n manual</li> <li>Developer onboarding: Setup guides</li> </ol>"},{"location":"audit/quality_baseline/#baseline-metrics-summary","title":"\ud83d\udcca Baseline Metrics Summary","text":"M\u00e9trica Actual Target Status Docstring Coverage 90.1% 95%+ \u2705 Test Coverage 100% 100% \u2705 Style Issues 1,520 &lt;500 \ud83d\udd04 API Docs 0% 100% \ud83d\udd04 User Guides 0% 100% \ud83d\udd04"},{"location":"audit/quality_baseline/#next-steps-fase-2","title":"\ud83d\ude80 Next Steps (FASE 2)","text":"<ol> <li>MkDocs Setup: Configuraci\u00f3n inicial</li> <li>Auto-generation: API docs desde docstrings  </li> <li>Manual docs: User guides y tutorials</li> <li>Quality fixes: Resolver issues cr\u00edticos</li> </ol> <p>Nota: Esta baseline ser\u00e1 el punto de referencia para medir mejoras en documentaci\u00f3n durante las pr\u00f3ximas fases del proyecto.</p>"},{"location":"audit/validation_report/","title":"Reporte de Validaci\u00f3n de Documentaci\u00f3n","text":"<p>Fecha: 2025-07-24 22:42:13 Proyecto: Facturaci\u00f3n M\u00e9xico</p>"},{"location":"audit/validation_report/#estadisticas","title":"\ud83d\udcca Estad\u00edsticas","text":"<ul> <li>Total archivos MD: 17</li> <li>Archivos v\u00e1lidos: 17</li> <li>Enlaces rotos: 0</li> <li>Im\u00e1genes faltantes: 0</li> <li>Archivos hu\u00e9rfanos: 0</li> </ul>"},{"location":"audit/validation_report/#advertencias-35","title":"\u26a0\ufe0f Advertencias (35)","text":"<ol> <li>Salto de nivel de header en docs/index.md: Configuraci\u00f3n B\u00e1sica</li> <li>Salto de nivel de header en docs/development/setup.md: 2. Setup Frappe Bench</li> <li>Salto de nivel de header en docs/development/setup.md: 3. Configuraci\u00f3n de Desarrollo</li> <li>Salto de nivel de header en docs/development/setup.md: Configuraci\u00f3n site_config.json</li> <li>Salto de nivel de header en docs/development/setup.md: Ejecutar Tests</li> <li>Salto de nivel de header en docs/development/setup.md: Tests por Layer</li> <li>Salto de nivel de header en docs/development/setup.md: Tests Espec\u00edficos</li> <li>Salto de nivel de header en docs/development/setup.md: Debugging Tests</li> <li>Salto de nivel de header en docs/development/setup.md: Con logs detallados</li> <li>Salto de nivel de header en docs/development/setup.md: .pre-commit-config.yaml</li> <li>Salto de nivel de header en docs/development/setup.md: Documentation Quality</li> <li>Salto de nivel de header en docs/development/setup.md: Memory Profiling</li> <li>Salto de nivel de header en docs/development/setup.md: Database Query Monitoring</li> <li>Salto de nivel de header en docs/development/setup.md: docker-compose.dev.yml</li> <li>Salto de nivel de header en docs/development/setup.md: Conventional Commits</li> <li>Salto de nivel de header en docs/development/setup.md: Pull Request Checklist</li> <li>Salto de nivel de header en docs/user-guide/multisucursal.md: Configuraci\u00f3n por Cliente</li> <li>Salto de nivel de header en docs/user-guide/multisucursal.md: Alertas y Notificaciones</li> <li>Salto de nivel de header en docs/user-guide/multisucursal.md: Failover No Funciona</li> <li>Salto de nivel de header en docs/user-guide/multisucursal.md: Distribuci\u00f3n Desbalanceada</li> <li>Salto de nivel de header en docs/user-guide/troubleshooting.md: Console Commands</li> <li>Salto de nivel de header en docs/user-guide/troubleshooting.md: Health Check Script</li> <li>Salto de nivel de header en docs/user-guide/getting-started.md: 3. Configuraci\u00f3n Inicial</li> <li>Salto de nivel de header en docs/user-guide/getting-started.md: Configuraci\u00f3n de Company</li> <li>Salto de nivel de header en docs/user-guide/getting-started.md: Verificar Resultados</li> <li>Salto de nivel de header en docs/user-guide/getting-started.md: Error: \"Invalid SAT Catalog\"</li> <li>Salto de nivel de header en docs/user-guide/getting-started.md: Error: \"Certificate validation failed\"</li> <li>Salto de nivel de header en docs/user-guide/getting-started.md: Error en Addendas</li> <li>Salto de nivel de header en docs/user-guide/addendas.md: Proceso Manual</li> <li>Salto de nivel de header en docs/user-guide/addendas.md: Crear Template Personalizado</li> <li>Salto de nivel de header en docs/user-guide/addendas.md: Test de Generaci\u00f3n</li> <li>Salto de nivel de header en docs/user-guide/addendas.md: Error de Validaci\u00f3n</li> <li>Salto de nivel de header en docs/user-guide/addendas.md: Template No Se Encuentra</li> <li>Comando peligroso en docs/user-guide/troubleshooting.md l\u00ednea 61: format</li> <li>Comando peligroso en docs/user-guide/troubleshooting.md l\u00ednea 221: format</li> </ol>"},{"location":"audit/validation_report/#estado-final-valida","title":"Estado Final: \u2705 V\u00c1LIDA","text":"<p>\u2705 Documentaci\u00f3n v\u00e1lida con advertencias menores.</p>"},{"location":"development/","title":"Gu\u00eda de Desarrollo - Facturaci\u00f3n M\u00e9xico","text":"<p>Documentaci\u00f3n t\u00e9cnica para desarrolladores que contribuyen al proyecto.</p>"},{"location":"development/#setup-del-entorno","title":"Setup del Entorno","text":""},{"location":"development/#requisitos","title":"Requisitos","text":"<ul> <li>Frappe Framework v15</li> <li>Python 3.8+</li> <li>Node.js 16+</li> <li>MariaDB 10.6+</li> </ul>"},{"location":"development/#instalacion-para-desarrollo","title":"Instalaci\u00f3n para Desarrollo","text":"<pre><code># 1. Clonar repositorio\ngit clone https://github.com/tu-org/facturacion_mexico.git\n\n# 2. Setup bench\nbench get-app facturacion_mexico /path/to/repo\n\n# 3. Instalar dependencias\nbench --site development.local install-app facturacion_mexico\n\n# 4. Ejecutar tests\nbench --site development.local run-tests --app facturacion_mexico\n</code></pre>"},{"location":"development/#estructura-del-proyecto","title":"Estructura del Proyecto","text":""},{"location":"development/#modulos-core","title":"M\u00f3dulos Core","text":"<ul> <li><code>cfdi/</code> - Timbrado y validaci\u00f3n</li> <li><code>multisucursal/</code> - Gesti\u00f3n branches</li> <li><code>addendas/</code> - Generaci\u00f3n din\u00e1mica</li> <li><code>catalogos_sat/</code> - Sincronizaci\u00f3n SAT</li> </ul>"},{"location":"development/#testing-framework","title":"Testing Framework","text":"<ul> <li>Layer 1: Unit tests</li> <li>Layer 2: Integration tests  </li> <li>Layer 3: Workflow tests</li> <li>Layer 4: Production tests</li> </ul>"},{"location":"development/#contribuciones","title":"Contribuciones","text":""},{"location":"development/#standards","title":"Standards","text":"<ul> <li>Google-style docstrings</li> <li>Conventional commits</li> <li>90%+ test coverage</li> <li>Spanish labels, English code</li> </ul> <p>Testing</p> <p>Todos los PRs deben tener 100% de tests exitosos antes del merge.</p>"},{"location":"development/setup/","title":"Setup de Desarrollo - Facturaci\u00f3n M\u00e9xico","text":"<p>Gu\u00eda completa para configurar el entorno de desarrollo del proyecto.</p>"},{"location":"development/setup/#entorno-de-desarrollo","title":"\ud83d\udee0\ufe0f Entorno de Desarrollo","text":""},{"location":"development/setup/#requisitos-del-sistema","title":"Requisitos del Sistema","text":""},{"location":"development/setup/#software-base","title":"Software Base","text":"<ul> <li>Python 3.8+ (recomendado 3.10+)</li> <li>Node.js 16+ con npm</li> <li>MariaDB 10.6+ o MySQL 8.0+</li> <li>Redis (para cache y queue)</li> <li>Git para control de versiones</li> </ul>"},{"location":"development/setup/#herramientas-de-desarrollo","title":"Herramientas de Desarrollo","text":"<ul> <li>VS Code con extensiones Python y JavaScript</li> <li>Postman o Thunder Client para API testing</li> <li>Docker (opcional, para testing isolado)</li> </ul>"},{"location":"development/setup/#instalacion-paso-a-paso","title":"Instalaci\u00f3n Paso a Paso","text":""},{"location":"development/setup/#1-clonar-repositorio","title":"1. Clonar Repositorio","text":"<pre><code># Clonar el repositorio principal\ngit clone https://github.com/tu-org/facturacion_mexico.git\ncd facturacion_mexico\n\n# Revisar branches disponibles\ngit branch -a\n\n# Cambiar a branch de desarrollo\ngit checkout develop\n</code></pre>"},{"location":"development/setup/#2-setup-frappe-bench","title":"2. Setup Frappe Bench","text":"<pre><code># Crear nuevo bench para desarrollo\nbench init --frappe-branch version-15 frappe-dev\ncd frappe-dev\n\n# Obtener la app desde repo local\nbench get-app facturacion_mexico /path/to/facturacion_mexico\n\n# Crear site de desarrollo\nbench new-site dev.facturacion.local --db-root-password your_password\n\n# Instalar app\nbench --site dev.facturacion.local install-app facturacion_mexico\n</code></pre>"},{"location":"development/setup/#3-configuracion-de-desarrollo","title":"3. Configuraci\u00f3n de Desarrollo","text":"<pre><code># Habilitar modo desarrollador\nbench --site dev.facturacion.local set-config developer_mode 1\n\n# Configurar debug mode\nbench --site dev.facturacion.local set-config debug 1\n\n# Configurar reload autom\u00e1tico\nbench --site dev.facturacion.local set-config auto_reload 1\n</code></pre>"},{"location":"development/setup/#configuracion-site_configjson","title":"Configuraci\u00f3n site_config.json","text":"<pre><code>{\n  \"developer_mode\": 1,\n  \"debug\": 1,\n  \"auto_reload\": 1,\n  \"pac_provider\": \"finkok\",\n  \"pac_test_mode\": 1,\n  \"pac_username\": \"test_user\",\n  \"pac_password\": \"test_password\",\n  \"multisucursal_enabled\": 1,\n  \"addendas_auto_generation\": 1,\n  \"cfdi_version\": \"4.0\",\n  \"logging\": {\n    \"facturacion_mexico\": \"DEBUG\"\n  }\n}\n</code></pre>"},{"location":"development/setup/#setup-de-testing","title":"\ud83e\uddea Setup de Testing","text":""},{"location":"development/setup/#estructura-de-tests","title":"Estructura de Tests","text":"<pre><code>facturacion_mexico/tests/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 test_layer1_basic_cfdi_functionality.py          # 15 tests\n\u251c\u2500\u2500 test_layer2_advanced_multisucursal_operations.py # 15 tests  \n\u251c\u2500\u2500 test_layer3_*.py                                 # 12 tests (5 archivos)\n\u2514\u2500\u2500 test_layer4_*.py                                 # 4 tests (4 archivos)\n</code></pre>"},{"location":"development/setup/#configuracion-de-test-environment","title":"Configuraci\u00f3n de Test Environment","text":"<pre><code># Crear site espec\u00edfico para tests\nbench new-site test.facturacion.local --db-root-password your_password\n\n# Instalar app en site de tests\nbench --site test.facturacion.local install-app facturacion_mexico\n\n# Configurar datos de prueba\nbench --site test.facturacion.local execute facturacion_mexico.install.before_tests\n</code></pre>"},{"location":"development/setup/#ejecutar-tests","title":"Ejecutar Tests","text":""},{"location":"development/setup/#tests-completos","title":"Tests Completos","text":"<pre><code># Todos los tests (46 tests)\nbench --site test.facturacion.local run-tests --app facturacion_mexico\n\n# Con coverage\nbench --site test.facturacion.local run-tests --app facturacion_mexico --coverage\n\n# Verbose mode\nbench --site test.facturacion.local run-tests --app facturacion_mexico -v\n</code></pre>"},{"location":"development/setup/#tests-por-layer","title":"Tests por Layer","text":"<pre><code># Layer 1: Funcionalidad b\u00e1sica CFDI\nbench --site test.facturacion.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer1_basic_cfdi_functionality\n\n# Layer 2: Operaciones multi-sucursal avanzadas  \nbench --site test.facturacion.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer2_advanced_multisucursal_operations\n\n# Layer 3: Integraci\u00f3n completa del sistema\nbench --site test.facturacion.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer3_complete_system_integration_sprint6\n\n# Layer 4: Tests de producci\u00f3n\nbench --site test.facturacion.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer4_sprint6_multisucursal_production\n</code></pre>"},{"location":"development/setup/#tests-especificos","title":"Tests Espec\u00edficos","text":"<pre><code># Test espec\u00edfico por nombre\nbench --site test.facturacion.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer1_basic_cfdi_functionality --test test_basic_cfdi_creation\n\n# Tests que coincidan con patr\u00f3n\nbench --site test.facturacion.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer3_addenda_multisucursal_workflows --test \"*addenda*\"\n</code></pre>"},{"location":"development/setup/#debugging-tests","title":"Debugging Tests","text":""},{"location":"development/setup/#con-pdb","title":"Con pdb","text":"<pre><code># En el c\u00f3digo de test\nimport pdb; pdb.set_trace()\n\n# O usando frappe debugger\nimport frappe\nfrappe.log_error(\"Debug point reached\", \"Test Debug\")\n</code></pre>"},{"location":"development/setup/#con-logs-detallados","title":"Con logs detallados","text":"<pre><code># Setup logging en tests\nimport logging\nlogging.basicConfig(level=logging.DEBUG)\n\n# O usando frappe logger\nimport frappe\nfrappe.logger(\"test_debug\").debug(\"Test checkpoint reached\")\n</code></pre>"},{"location":"development/setup/#herramientas-de-desarrollo_1","title":"\ud83d\udd27 Herramientas de Desarrollo","text":""},{"location":"development/setup/#pre-commit-hooks","title":"Pre-commit Hooks","text":"<pre><code># Instalar pre-commit\npip install pre-commit\n\n# Setup hooks\npre-commit install\n\n# Ejecutar manualmente\npre-commit run --all-files\n</code></pre>"},{"location":"development/setup/#pre-commit-configyaml","title":".pre-commit-config.yaml","text":"<pre><code>repos:\n  - repo: https://github.com/psf/black\n    rev: 23.1.0\n    hooks:\n      - id: black\n        language_version: python3\n\n  - repo: https://github.com/pycqa/flake8\n    rev: 6.0.0\n    hooks:\n      - id: flake8\n        args: [--max-line-length=100]\n\n  - repo: https://github.com/pycqa/isort\n    rev: 5.12.0\n    hooks:\n      - id: isort\n        args: [--profile=black]\n</code></pre>"},{"location":"development/setup/#code-quality-tools","title":"Code Quality Tools","text":""},{"location":"development/setup/#linting","title":"Linting","text":"<pre><code># flake8 para style checking\nflake8 facturacion_mexico/ --max-line-length=100\n\n# black para formatting\nblack facturacion_mexico/\n\n# isort para import sorting  \nisort facturacion_mexico/ --profile=black\n</code></pre>"},{"location":"development/setup/#documentation-quality","title":"Documentation Quality","text":"<pre><code># pydocstyle para docstring checking\npydocstyle facturacion_mexico/ --convention=google\n\n# interrogate para docstring coverage\ninterrogate facturacion_mexico/ --verbose\n</code></pre>"},{"location":"development/setup/#monitoreo-de-desarrollo","title":"\ud83d\udcca Monitoreo de Desarrollo","text":""},{"location":"development/setup/#performance-profiling","title":"Performance Profiling","text":"<pre><code># Profiling de funciones cr\u00edticas\nimport cProfile\nimport pstats\nfrom functools import wraps\n\ndef profile_function(func):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        pr = cProfile.Profile()\n        pr.enable()\n        result = func(*args, **kwargs)\n        pr.disable()\n\n        stats = pstats.Stats(pr)\n        stats.sort_stats('cumulative')\n        stats.print_stats(10)  # Top 10 functions\n\n        return result\n    return wrapper\n\n# Uso en c\u00f3digo\n@profile_function\ndef generate_cfdi_xml(invoice_doc):\n    # Implementaci\u00f3n...\n    pass\n</code></pre>"},{"location":"development/setup/#memory-profiling","title":"Memory Profiling","text":"<pre><code># Con memory_profiler\nfrom memory_profiler import profile\n\n@profile\ndef memory_intensive_function():\n    # C\u00f3digo que consume memoria\n    pass\n\n# Ejecutar con:\n# python -m memory_profiler script.py\n</code></pre>"},{"location":"development/setup/#database-query-monitoring","title":"Database Query Monitoring","text":"<pre><code># Monitoring de queries\nimport frappe\n\n# Habilitar query logging\nfrappe.db.debug = True\n\n# Ver queries ejecutadas\nprint(frappe.db.get_query_log())\n\n# Resetear log  \nfrappe.db.reset_query_log()\n</code></pre>"},{"location":"development/setup/#deployment-testing","title":"\ud83d\ude80 Deployment Testing","text":""},{"location":"development/setup/#docker-environment","title":"Docker Environment","text":""},{"location":"development/setup/#dockerfiledev","title":"Dockerfile.dev","text":"<pre><code>FROM frappe/erpnext:v15\n\n# Copy app\nCOPY . /home/frappe/frappe-bench/apps/facturacion_mexico\n\n# Install app\nRUN cd /home/frappe/frappe-bench &amp;&amp; \\\n    bench get-app facturacion_mexico --resolve-deps &amp;&amp; \\\n    bench build\n\n# Development specific configurations\nENV DEVELOPER_MODE=1\nENV DEBUG_MODE=1\n</code></pre>"},{"location":"development/setup/#docker-composedevyml","title":"docker-compose.dev.yml","text":"<pre><code>version: '3.8'\n\nservices:\n  erpnext:\n    build:\n      context: .\n      dockerfile: Dockerfile.dev\n    ports:\n      - \"8000:8000\"\n    environment:\n      - SITE_NAME=dev.facturacion.local\n      - DB_ROOT_PASSWORD=admin\n    volumes:\n      - ./facturacion_mexico:/home/frappe/frappe-bench/apps/facturacion_mexico\n    depends_on:\n      - db\n      - redis\n\n  db:\n    image: mariadb:10.6\n    environment:\n      - MYSQL_ROOT_PASSWORD=admin\n\n  redis:\n    image: redis:alpine\n</code></pre>"},{"location":"development/setup/#cicd-pipeline-testing","title":"CI/CD Pipeline Testing","text":"<pre><code># .github/workflows/test.yml\nname: Tests\n\non: [push, pull_request]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n\n    services:\n      mariadb:\n        image: mariadb:10.6\n        env:\n          MYSQL_ROOT_PASSWORD: root\n        options: --health-cmd=\"mysqladmin ping\" --health-interval=10s\n\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Setup Python\n        uses: actions/setup-python@v4\n        with:\n          python-version: '3.10'\n\n      - name: Install Frappe\n        run: |\n          pip install frappe-bench\n          bench init --skip-redis-config-generation frappe-bench\n\n      - name: Setup App\n        run: |\n          cd frappe-bench\n          bench get-app facturacion_mexico $GITHUB_WORKSPACE\n          bench new-site test.local --db-root-password root\n          bench install-app facturacion_mexico --site test.local\n\n      - name: Run Tests\n        run: |\n          cd frappe-bench\n          bench --site test.local run-tests --app facturacion_mexico --coverage\n</code></pre>"},{"location":"development/setup/#workflow-de-desarrollo","title":"\ud83d\udd04 Workflow de Desarrollo","text":""},{"location":"development/setup/#branch-strategy","title":"Branch Strategy","text":"<pre><code># Feature branch\ngit checkout -b feature/nueva-funcionalidad\n\n# Desarrollo...\ngit add .\ngit commit -m \"feat: agregar nueva funcionalidad\"\n\n# Push y crear PR  \ngit push origin feature/nueva-funcionalidad\n</code></pre>"},{"location":"development/setup/#conventional-commits","title":"Conventional Commits","text":"<pre><code># Ejemplos de commits v\u00e1lidos\ngit commit -m \"feat: agregar soporte para addendas Liverpool\"\ngit commit -m \"fix: corregir validaci\u00f3n RFC en CFDI generation\"\ngit commit -m \"test: agregar tests para multi-sucursal failover\"\ngit commit -m \"docs: actualizar documentaci\u00f3n API\"\ngit commit -m \"refactor: optimizar algoritmo de selecci\u00f3n de branch\"\n</code></pre>"},{"location":"development/setup/#pull-request-checklist","title":"Pull Request Checklist","text":"<ul> <li>[ ] Tests pasan (46/46) \u2705</li> <li>[ ] Code coverage &gt; 90% \u2705  </li> <li>[ ] Linting sin errores \u2705</li> <li>[ ] Documentaci\u00f3n actualizada \u2705</li> <li>[ ] CHANGELOG.md actualizado \u2705</li> <li>[ ] Conventional commits \u2705</li> </ul> <p>Performance</p> <p>Usa <code>bench --site site.local clear-cache</code> frecuentemente durante desarrollo para evitar cache issues.</p> <p>Database</p> <p>Nunca hagas cambios directos a la DB en development. Usa migrations para cambios de schema.</p> <p>Hot Reload</p> <p>Con <code>auto_reload: 1</code>, Frappe recargar\u00e1 autom\u00e1ticamente cuando detecte cambios en Python files.</p>"},{"location":"user-guide/","title":"Gu\u00eda de Usuario - Facturaci\u00f3n M\u00e9xico","text":"<p>Documentaci\u00f3n completa para usuarios del sistema de facturaci\u00f3n electr\u00f3nica.</p>"},{"location":"user-guide/#contenido-de-la-guia","title":"Contenido de la Gu\u00eda","text":""},{"location":"user-guide/#primeros-pasos","title":"Primeros Pasos","text":"<ul> <li>Configuraci\u00f3n inicial del sistema</li> <li>Setup de certificados SAT</li> <li>Configuraci\u00f3n de catalogos</li> </ul>"},{"location":"user-guide/#funcionalidades-principales","title":"Funcionalidades Principales","text":"<ul> <li>CFDI 4.0 - Timbrado y validaci\u00f3n</li> <li>Multi-sucursal - Gesti\u00f3n de branches</li> <li>Addendas - Generaci\u00f3n din\u00e1mica</li> <li>Reportes - Analytics y m\u00e9tricas</li> </ul>"},{"location":"user-guide/#casos-de-uso-comunes","title":"Casos de Uso Comunes","text":"<ul> <li>Facturaci\u00f3n b\u00e1sica</li> <li>Configuraci\u00f3n multi-sucursal</li> <li>Gesti\u00f3n de addendas personalizadas</li> <li>Resoluci\u00f3n de problemas comunes</li> </ul> <p>Comenzando</p> <p>Si es tu primera vez usando el sistema, te recomendamos empezar con la secci\u00f3n de Primeros Pasos.</p>"},{"location":"user-guide/addendas/","title":"Addendas - Gu\u00eda de Usuario","text":"<p>Gu\u00eda completa para configurar y usar el sistema de addendas autom\u00e1ticas.</p>"},{"location":"user-guide/addendas/#que-son-las-addendas","title":"\ud83d\udcc4 \u00bfQu\u00e9 son las Addendas?","text":"<p>Las addendas son documentos XML adicionales que se anexan al CFDI para cumplir con requisitos espec\u00edficos de grandes clientes como:</p> <ul> <li>Walmart M\u00e9xico - Formato de requestForPayment</li> <li>Liverpool - Datos de proveedor y pedido</li> <li>Chedraui - Informaci\u00f3n de orden de compra</li> <li>Soriana - Detalles de entrega y facturaci\u00f3n</li> <li>OXXO - C\u00f3digos de producto espec\u00edficos</li> </ul>"},{"location":"user-guide/addendas/#configuracion-inicial","title":"\u2699\ufe0f Configuraci\u00f3n Inicial","text":""},{"location":"user-guide/addendas/#1-habilitar-addendas","title":"1. Habilitar Addendas","text":"<p>En tu <code>site_config.json</code>:</p> <pre><code>{\n  \"addendas_auto_generation\": 1,\n  \"addenda_validation_strict\": 1,\n  \"addenda_templates_path\": \"addendas/templates/\"\n}\n</code></pre>"},{"location":"user-guide/addendas/#2-configurar-templates","title":"2. Configurar Templates","text":"<p>Los templates est\u00e1n en <code>addendas/templates/</code>:</p> <pre><code>addendas/templates/\n\u251c\u2500\u2500 walmart_mx.xml\n\u251c\u2500\u2500 liverpool_mx.xml  \n\u251c\u2500\u2500 chedraui_mx.xml\n\u251c\u2500\u2500 soriana_mx.xml\n\u2514\u2500\u2500 custom/\n    \u2514\u2500\u2500 cliente_especial.xml\n</code></pre>"},{"location":"user-guide/addendas/#3-configurar-tipos-de-addenda","title":"3. Configurar Tipos de Addenda","text":"<p>Ve a Setup &gt; Facturaci\u00f3n M\u00e9xico &gt; Addenda Types:</p>"},{"location":"user-guide/addendas/#walmart-mexico","title":"Walmart M\u00e9xico","text":"<pre><code>Addenda Type: WALMART_MX\nTemplate File: walmart_mx.xml\nAuto Apply: \u2713 (marcado)\nRequired Fields:\n- purchase_order\n- vendor_number  \n- store_number\n</code></pre>"},{"location":"user-guide/addendas/#liverpool","title":"Liverpool","text":"<pre><code>Addenda Type: LIVERPOOL_MX\nTemplate File: liverpool_mx.xml\nAuto Apply: \u2713 (marcado)\nRequired Fields:\n- proveedor_id\n- num_pedido\n- sucursal\n</code></pre>"},{"location":"user-guide/addendas/#configurar-clientes","title":"\ud83d\udc65 Configurar Clientes","text":""},{"location":"user-guide/addendas/#cliente-con-addenda-automatica","title":"Cliente con Addenda Autom\u00e1tica","text":"<ol> <li>Ve a Selling &gt; Customer</li> <li>Abrir o crear cliente (ej: \"Walmart de M\u00e9xico\")</li> <li>En secci\u00f3n Facturaci\u00f3n M\u00e9xico:</li> <li>Marcar FM Addenda Required: \u2713</li> <li>Seleccionar Addenda Type: <code>WALMART_MX</code></li> <li>Configurar Auto Apply: \u2713</li> </ol>"},{"location":"user-guide/addendas/#campos-especificos-por-cliente","title":"Campos Espec\u00edficos por Cliente","text":""},{"location":"user-guide/addendas/#para-walmart","title":"Para Walmart","text":"<p>En Customer &gt; Custom Fields:</p> <pre><code>Vendor Number: WAL001234\nStore Network: Walmart M\u00e9xico\nPayment Terms: NET30\nPurchase Order Pattern: ^\\d{10}$\n</code></pre>"},{"location":"user-guide/addendas/#para-liverpool","title":"Para Liverpool","text":"<pre><code>Proveedor ID: LIV001234  \nSucursal Code: LIV-CENTRO\nNum Pedido Pattern: ^LP\\d{8}$\n</code></pre>"},{"location":"user-guide/addendas/#uso-diario","title":"\ud83d\udccb Uso Diario","text":""},{"location":"user-guide/addendas/#crear-factura-con-addenda","title":"Crear Factura con Addenda","text":""},{"location":"user-guide/addendas/#proceso-automatico","title":"Proceso Autom\u00e1tico","text":"<ol> <li>Crear Sales Invoice para cliente con addenda configurada</li> <li>Completar campos obligatorios:</li> <li>Purchase Order: 1234567890 (para Walmart)</li> <li>Store Number: 2587</li> <li>Submit la factura</li> <li>La addenda se genera autom\u00e1ticamente</li> </ol>"},{"location":"user-guide/addendas/#verificar-addenda-generada","title":"Verificar Addenda Generada","text":"<p>Despu\u00e9s del submit:</p> <pre><code># Desde consola\nimport frappe\n\ninvoice = frappe.get_doc(\"Sales Invoice\", \"SINV-00001\")\nprint(f\"Addenda generada: {bool(invoice.get('addenda_xml'))}\")\nprint(f\"Tipo de addenda: {invoice.get('addenda_type')}\")\nprint(f\"Validaci\u00f3n: {invoice.get('addenda_validation_status')}\")\n</code></pre>"},{"location":"user-guide/addendas/#proceso-manual","title":"Proceso Manual","text":"<p>Si necesitas generar la addenda manualmente:</p> <ol> <li>En Sales Invoice, ir a More &gt; Generate Addenda</li> <li>Seleccionar tipo de addenda</li> <li>Completar campos requeridos</li> <li>Clic en Generate</li> </ol>"},{"location":"user-guide/addendas/#templates-personalizados","title":"\ud83d\udd27 Templates Personalizados","text":""},{"location":"user-guide/addendas/#estructura-de-template","title":"Estructura de Template","text":""},{"location":"user-guide/addendas/#walmart-template-walmart_mxxml","title":"Walmart Template (walmart_mx.xml)","text":"<pre><code>&lt;cfdi:Addenda&gt;\n    &lt;Walmart&gt;\n        &lt;requestForPayment&gt;\n            &lt;PaymentTerms&gt;{{ payment_terms | default('NET30') }}&lt;/PaymentTerms&gt;\n            &lt;InvoiceNumber&gt;{{ invoice_number }}&lt;/InvoiceNumber&gt;\n            &lt;PurchaseOrder&gt;{{ purchase_order | rfc_format }}&lt;/PurchaseOrder&gt;\n            &lt;VendorNumber&gt;{{ vendor_number }}&lt;/VendorNumber&gt;\n            &lt;StoreNumber&gt;{{ store_number }}&lt;/StoreNumber&gt;\n            &lt;InvoiceDate&gt;{{ invoice_date | sat_datetime }}&lt;/InvoiceDate&gt;\n            &lt;InvoiceAmount currency=\"MXN\"&gt;{{ grand_total | round(2) }}&lt;/InvoiceAmount&gt;\n        &lt;/requestForPayment&gt;\n    &lt;/Walmart&gt;\n&lt;/cfdi:Addenda&gt;\n</code></pre>"},{"location":"user-guide/addendas/#custom-filters","title":"Custom Filters","text":""},{"location":"user-guide/addendas/#filtros-disponibles","title":"Filtros Disponibles","text":"<ul> <li><code>sat_datetime</code>: Formato de fecha SAT (AAAA-MM-DDTHH:MM:SS)</li> <li><code>rfc_format</code>: Validaci\u00f3n de formato RFC</li> <li><code>currency_format</code>: Formato de moneda (2 decimales)</li> <li><code>uppercase</code>: Convertir a may\u00fasculas</li> <li><code>remove_accents</code>: Quitar acentos</li> </ul>"},{"location":"user-guide/addendas/#crear-filtros-personalizados","title":"Crear Filtros Personalizados","text":"<pre><code># En hooks.py\ndef custom_addenda_filters():\n    return {\n        \"walmart_date\": lambda date: date.strftime(\"%Y%m%d\"),\n        \"pad_zeros\": lambda value, length: str(value).zfill(length),\n        \"truncate\": lambda text, max_len: text[:max_len] if text else \"\"\n    }\n</code></pre>"},{"location":"user-guide/addendas/#crear-template-personalizado","title":"Crear Template Personalizado","text":""},{"location":"user-guide/addendas/#1-crear-archivo-xml","title":"1. Crear archivo XML","text":"<p><code>addendas/templates/custom/mi_cliente.xml</code>:</p> <pre><code>&lt;cfdi:Addenda&gt;\n    &lt;MiCliente&gt;\n        &lt;DatosFactura&gt;\n            &lt;NumeroFactura&gt;{{ invoice_number }}&lt;/NumeroFactura&gt;\n            &lt;FechaFactura&gt;{{ invoice_date | sat_datetime }}&lt;/FechaFactura&gt;\n            &lt;CodigoCliente&gt;{{ customer_code | uppercase }}&lt;/CodigoCliente&gt;\n            &lt;ImporteTotal&gt;{{ grand_total | currency_format }}&lt;/ImporteTotal&gt;\n        &lt;/DatosFactura&gt;\n        &lt;DetalleItems&gt;\n            {% for item in items %}\n            &lt;Item&gt;\n                &lt;Codigo&gt;{{ item.item_code }}&lt;/Codigo&gt;\n                &lt;Descripcion&gt;{{ item.description | truncate(50) }}&lt;/Descripcion&gt;\n                &lt;Cantidad&gt;{{ item.qty }}&lt;/Cantidad&gt;\n                &lt;Precio&gt;{{ item.rate | currency_format }}&lt;/Precio&gt;\n            &lt;/Item&gt;\n            {% endfor %}\n        &lt;/DetalleItems&gt;\n    &lt;/MiCliente&gt;\n&lt;/cfdi:Addenda&gt;\n</code></pre>"},{"location":"user-guide/addendas/#2-registrar-template","title":"2. Registrar Template","text":"<pre><code># Setup del template personalizado\nfrappe.get_doc({\n    \"doctype\": \"Addenda Type\",\n    \"addenda_type\": \"MI_CLIENTE_MX\",\n    \"template_file\": \"custom/mi_cliente.xml\",\n    \"auto_apply\": True,\n    \"required_fields\": [\"customer_code\", \"invoice_date\"],\n    \"validation_rules\": {\n        \"customer_code\": r\"^MC\\d{6}$\"\n    }\n}).insert()\n</code></pre>"},{"location":"user-guide/addendas/#validacion-y-testing","title":"\ud83e\uddea Validaci\u00f3n y Testing","text":""},{"location":"user-guide/addendas/#validar-addenda","title":"Validar Addenda","text":"<pre><code># Validar addenda generada\nfrom facturacion_mexico.addendas.validator import validate_addenda\n\ninvoice = frappe.get_doc(\"Sales Invoice\", \"SINV-00001\")\nresult = validate_addenda(invoice.addenda_xml, invoice.addenda_type)\n\nprint(f\"V\u00e1lida: {result.is_valid}\")\nif not result.is_valid:\n    print(f\"Errores: {result.errors}\")\n</code></pre>"},{"location":"user-guide/addendas/#test-de-generacion","title":"Test de Generaci\u00f3n","text":"<pre><code># Test completo de generaci\u00f3n\nfrom facturacion_mexico.addendas.generator import generate_test_addenda\n\n# Generar addenda de prueba\ntest_data = {\n    \"customer\": \"Walmart de M\u00e9xico\",\n    \"purchase_order\": \"1234567890\",\n    \"vendor_number\": \"WAL001234\",\n    \"store_number\": \"2587\"\n}\n\naddenda_xml = generate_test_addenda(\"WALMART_MX\", test_data)\nprint(\"Addenda generada exitosamente\")\n</code></pre>"},{"location":"user-guide/addendas/#monitoreo-y-reportes","title":"\ud83d\udcca Monitoreo y Reportes","text":""},{"location":"user-guide/addendas/#reporte-de-addendas","title":"Reporte de Addendas","text":"<p>Ve a Reports &gt; Facturaci\u00f3n M\u00e9xico &gt; Addenda Generation Report:</p> <ul> <li>Addendas generadas por per\u00edodo</li> <li>Tasa de \u00e9xito por tipo</li> <li>Errores de validaci\u00f3n frecuentes</li> <li>Clientes sin configuraci\u00f3n</li> </ul>"},{"location":"user-guide/addendas/#metricas-de-performance","title":"M\u00e9tricas de Performance","text":"<pre><code># M\u00e9tricas de addendas\nfrom facturacion_mexico.addendas.metrics import get_addenda_metrics\n\nmetrics = get_addenda_metrics(days=30)\nprint(f\"Total generadas: {metrics['total_generated']}\")\nprint(f\"Tasa de \u00e9xito: {metrics['success_rate']}%\")\nprint(f\"Tiempo promedio: {metrics['avg_generation_time']}ms\")\n</code></pre>"},{"location":"user-guide/addendas/#mantenimiento","title":"\ud83d\udd04 Mantenimiento","text":""},{"location":"user-guide/addendas/#actualizar-templates","title":"Actualizar Templates","text":"<ol> <li> <p>Backup del template actual:    <pre><code>cp addendas/templates/walmart_mx.xml addendas/templates/backup/walmart_mx_v1.xml\n</code></pre></p> </li> <li> <p>Actualizar template:</p> </li> <li>Editar el archivo XML</li> <li>Validar sintaxis</li> <li> <p>Probar con datos de ejemplo</p> </li> <li> <p>Deploy gradual:    <pre><code># Activar nueva versi\u00f3n gradualmente\nfrappe.db.set_value(\"Addenda Type\", \"WALMART_MX\", \"template_version\", \"v2.0\")\n</code></pre></p> </li> </ol>"},{"location":"user-guide/addendas/#migrar-configuraciones","title":"Migrar Configuraciones","text":"<pre><code># Script de migraci\u00f3n\ndef migrate_addenda_configs():\n    \"\"\"Migrar configuraciones de addenda a nueva versi\u00f3n.\"\"\"\n\n    # Actualizar tipos existentes\n    old_types = frappe.get_all(\"Addenda Type\", \n                              filters={\"template_version\": [\"&lt;\", \"2.0\"]})\n\n    for addenda_type in old_types:\n        doc = frappe.get_doc(\"Addenda Type\", addenda_type.name)\n\n        # Actualizar configuraci\u00f3n\n        doc.template_version = \"2.0\"\n        doc.validation_rules = upgrade_validation_rules(doc.validation_rules)\n        doc.save()\n\n        print(f\"Migrado: {doc.addenda_type}\")\n</code></pre>"},{"location":"user-guide/addendas/#troubleshooting","title":"\ud83d\udea8 Troubleshooting","text":""},{"location":"user-guide/addendas/#addenda-no-se-genera","title":"Addenda No Se Genera","text":"<p>S\u00edntomas: - Campo <code>addenda_xml</code> vac\u00edo despu\u00e9s del submit - No aparece en el PDF del CFDI</p> <p>Soluci\u00f3n: 1. Verificar que el cliente tenga <code>FM Addenda Required</code> marcado 2. Confirmar que el tipo de addenda est\u00e9 configurado 3. Revisar que <code>auto_apply</code> est\u00e9 habilitado</p> <pre><code># Debug de configuraci\u00f3n\ncustomer = frappe.get_doc(\"Customer\", \"WALMART-001\")\nprint(f\"Addenda required: {customer.get('fm_addenda_required')}\")\nprint(f\"Addenda type: {customer.get('addenda_type')}\")\n\naddenda_type = frappe.get_doc(\"Addenda Type\", customer.addenda_type)\nprint(f\"Auto apply: {addenda_type.auto_apply}\")\n</code></pre>"},{"location":"user-guide/addendas/#error-de-validacion","title":"Error de Validaci\u00f3n","text":"<p>S\u00edntomas: - Addenda se genera pero falla validaci\u00f3n - Errores en XML structure</p> <p>Soluci\u00f3n: 1. Revisar template syntax 2. Verificar que todos los campos requeridos est\u00e9n presentes 3. Validar formato de datos</p> <pre><code># Debug de validaci\u00f3n\nfrom facturacion_mexico.addendas.validator import validate_addenda_xml\n\nxml_content = invoice.get('addenda_xml')\nvalidation_result = validate_addenda_xml(xml_content)\n\nif not validation_result.is_valid:\n    for error in validation_result.errors:\n        print(f\"Error: {error['message']} en l\u00ednea {error['line']}\")\n</code></pre>"},{"location":"user-guide/addendas/#template-no-se-encuentra","title":"Template No Se Encuentra","text":"<p>S\u00edntomas: - Error \"Template not found\" - Template file missing</p> <p>Soluci\u00f3n: 1. Verificar que el archivo existe en <code>addendas/templates/</code> 2. Confirmar permisos de lectura 3. Validar path en configuraci\u00f3n</p> <pre><code># Verificar templates disponibles\nls -la addendas/templates/\nfind . -name \"*.xml\" -type f | grep addendas\n</code></pre> <p>Automatizaci\u00f3n Completa</p> <p>Las addendas se generan autom\u00e1ticamente sin intervenci\u00f3n manual una vez configuradas.</p> <p>Validaci\u00f3n Estricta</p> <p>Activa <code>addenda_validation_strict: 1</code> para detectar errores temprano en desarrollo.</p> <p>Backup Templates</p> <p>Siempre mant\u00e9n backup de templates antes de actualizaciones para permitir rollback r\u00e1pido.</p>"},{"location":"user-guide/getting-started/","title":"Primeros Pasos - Facturaci\u00f3n M\u00e9xico","text":"<p>Gu\u00eda completa para comenzar a usar el sistema de facturaci\u00f3n electr\u00f3nica.</p>"},{"location":"user-guide/getting-started/#instalacion-inicial","title":"\ud83d\ude80 Instalaci\u00f3n Inicial","text":""},{"location":"user-guide/getting-started/#requisitos-previos","title":"Requisitos Previos","text":"<p>Antes de instalar, aseg\u00farate de tener:</p> <ul> <li>Frappe Framework v15 instalado y funcionando</li> <li>ERPNext (opcional pero recomendado)</li> <li>Python 3.8+ con todas las dependencias</li> <li>Certificados SAT v\u00e1lidos para timbrado</li> <li>Credenciales PAC activas</li> </ul>"},{"location":"user-guide/getting-started/#instalacion-paso-a-paso","title":"Instalaci\u00f3n Paso a Paso","text":""},{"location":"user-guide/getting-started/#1-obtener-la-app","title":"1. Obtener la App","text":"Desde GitHubDesde Local <pre><code># Clonar el repositorio\ncd /path/to/frappe-bench\nbench get-app facturacion_mexico https://github.com/tu-org/facturacion_mexico.git\n</code></pre> <pre><code># Si tienes el c\u00f3digo localmente\nbench get-app facturacion_mexico /path/to/local/repo\n</code></pre>"},{"location":"user-guide/getting-started/#2-instalar-en-site","title":"2. Instalar en Site","text":"<pre><code># Instalar en tu site\nbench --site tu-sitio.local install-app facturacion_mexico\n\n# Verificar instalaci\u00f3n\nbench --site tu-sitio.local console\n</code></pre> <pre><code># En la consola de Frappe\nimport frappe\nfrappe.get_installed_apps()\n# Debe aparecer 'facturacion_mexico' en la lista\n</code></pre>"},{"location":"user-guide/getting-started/#3-configuracion-inicial","title":"3. Configuraci\u00f3n Inicial","text":"<pre><code># Ejecutar setup inicial\nbench --site tu-sitio.local execute facturacion_mexico.install.before_tests\n\n# Esto crear\u00e1:\n# - Datos b\u00e1sicos de prueba\n# - Catalogos SAT m\u00ednimos  \n# - Configuraci\u00f3n de company\n# - Tipos de addenda b\u00e1sicos\n</code></pre>"},{"location":"user-guide/getting-started/#configuracion-basica","title":"\u2699\ufe0f Configuraci\u00f3n B\u00e1sica","text":""},{"location":"user-guide/getting-started/#site-config","title":"Site Config","text":"<p>Agrega la siguiente configuraci\u00f3n a tu <code>site_config.json</code>:</p> <pre><code>{\n  \"pac_provider\": \"finkok\",\n  \"pac_username\": \"tu_usuario_pac\",\n  \"pac_password\": \"tu_password_pac\",\n  \"pac_test_mode\": 1,\n  \"multisucursal_enabled\": 1,\n  \"addendas_auto_generation\": 1,\n  \"cfdi_version\": \"4.0\"\n}\n</code></pre>"},{"location":"user-guide/getting-started/#certificados-sat","title":"Certificados SAT","text":""},{"location":"user-guide/getting-started/#subir-certificados","title":"Subir Certificados","text":"<ol> <li>Ve a Setup &gt; Facturaci\u00f3n M\u00e9xico &gt; Certificados SAT</li> <li>Sube tu archivo <code>.cer</code> (certificado p\u00fablico)</li> <li>Sube tu archivo <code>.key</code> (llave privada)</li> <li>Ingresa la contrase\u00f1a de la llave privada</li> <li>Verifica que el estado sea \"V\u00e1lido\"</li> </ol> <pre><code># Verificar certificados desde consola\nimport frappe\nfrom facturacion_mexico.utils.certificates import validate_certificates\n\nresult = validate_certificates()\nprint(f\"Certificados v\u00e1lidos: {result['valid']}\")\nprint(f\"Vigencia hasta: {result['expires_on']}\")\n</code></pre>"},{"location":"user-guide/getting-started/#configuracion-de-company","title":"Configuraci\u00f3n de Company","text":""},{"location":"user-guide/getting-started/#datos-fiscales-obligatorios","title":"Datos Fiscales Obligatorios","text":"<p>Ve a Setup &gt; Company y completa:</p> <ul> <li>Tax ID (RFC): RFC de tu empresa</li> <li>R\u00e9gimen Fiscal: Selecciona de la lista SAT</li> <li>Direcci\u00f3n Fiscal: Completa con c\u00f3digo postal v\u00e1lido</li> <li>Moneda Base: MXN (requerido)</li> </ul>"},{"location":"user-guide/getting-started/#configuracion-multi-sucursal-opcional","title":"Configuraci\u00f3n Multi-sucursal (Opcional)","text":"<p>Si usar\u00e1s m\u00faltiples sucursales:</p> <pre><code># Crear branches desde consola\nimport frappe\n\n# Branch principal\nbranch_doc = frappe.get_doc({\n    \"doctype\": \"Branch\",\n    \"branch_code\": \"MATRIZ_01\",\n    \"branch_name\": \"Casa Matriz\",\n    \"is_primary\": 1,\n    \"pac_provider\": \"finkok\",\n    \"status\": \"Active\"\n})\nbranch_doc.insert()\n\n# Branch secundario\nbranch_doc = frappe.get_doc({\n    \"doctype\": \"Branch\", \n    \"branch_code\": \"SUCURSAL_01\",\n    \"branch_name\": \"Sucursal Norte\",\n    \"is_primary\": 0,\n    \"pac_provider\": \"finkok\", \n    \"status\": \"Active\"\n})\nbranch_doc.insert()\n</code></pre>"},{"location":"user-guide/getting-started/#primera-factura-cfdi","title":"\ud83d\udccb Primera Factura CFDI","text":""},{"location":"user-guide/getting-started/#crear-customer-con-datos-fiscales","title":"Crear Customer con Datos Fiscales","text":"<ol> <li>Ve a Selling &gt; Customer</li> <li>Crea un nuevo cliente</li> <li>En la secci\u00f3n Tax Details:</li> <li>Tax ID: RFC del cliente</li> <li>Tax Category: Selecciona apropiada</li> <li>Si requiere addenda, marca FM Addenda Required</li> </ol>"},{"location":"user-guide/getting-started/#crear-sales-invoice","title":"Crear Sales Invoice","text":"<ol> <li>Ve a Selling &gt; Sales Invoice </li> <li>Selecciona el customer creado</li> <li>Agrega items con c\u00f3digos SAT v\u00e1lidos</li> <li>Verifica que los impuestos se calculen correctamente</li> <li>Submit la factura</li> </ol>"},{"location":"user-guide/getting-started/#verificar-cfdi-generado","title":"Verificar CFDI Generado","text":"<p>Despu\u00e9s del submit, verifica:</p> <pre><code># Desde consola\nimport frappe\n\n# Obtener la factura\ninvoice = frappe.get_doc(\"Sales Invoice\", \"SINV-00001\")\n\n# Verificar campos CFDI\nprint(f\"CFDI UUID: {invoice.get('cfdi_uuid')}\")\nprint(f\"XML generado: {bool(invoice.get('cfdi_xml'))}\")\nprint(f\"Estado PAC: {invoice.get('cfdi_status')}\")\nprint(f\"Fecha timbrado: {invoice.get('cfdi_stamped_date')}\")\n</code></pre>"},{"location":"user-guide/getting-started/#ejecutar-tests","title":"\ud83e\uddea Ejecutar Tests","text":""},{"location":"user-guide/getting-started/#tests-basicos","title":"Tests B\u00e1sicos","text":"<pre><code># Tests completos\nbench --site tu-sitio.local run-tests --app facturacion_mexico\n\n# Tests espec\u00edficos por layer\nbench --site tu-sitio.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer1_basic_cfdi_functionality\n\n# Tests de integraci\u00f3n\nbench --site tu-sitio.local run-tests --app facturacion_mexico --module facturacion_mexico.tests.test_layer3_complete_system_integration_sprint6\n</code></pre>"},{"location":"user-guide/getting-started/#verificar-resultados","title":"Verificar Resultados","text":"<p>Los tests deben mostrar:</p> <pre><code>Ran 46 tests in XXX.XXXs\n\nPASSED (46 tests)\n- Layer 1: 15 tests \u2705 \n- Layer 2: 15 tests \u2705\n- Layer 3: 12 tests \u2705\n- Layer 4: 4 tests \u2705\n</code></pre>"},{"location":"user-guide/getting-started/#troubleshooting-comun","title":"\ud83d\udd27 Troubleshooting Com\u00fan","text":""},{"location":"user-guide/getting-started/#error-no-pac-configured","title":"Error: \"No PAC configured\"","text":"<p>Soluci\u00f3n: <pre><code># Verificar configuraci\u00f3n PAC\nbench --site tu-sitio.local console\n</code></pre></p> <pre><code>import frappe\nprint(frappe.conf.get('pac_provider'))\nprint(frappe.conf.get('pac_username'))\n# No imprimas la password por seguridad\n</code></pre>"},{"location":"user-guide/getting-started/#error-invalid-sat-catalog","title":"Error: \"Invalid SAT Catalog\"","text":"<p>Soluci\u00f3n: <pre><code># Sincronizar catalogos SAT\nbench --site tu-sitio.local execute facturacion_mexico.catalogos_sat.sync_all_catalogs\n</code></pre></p>"},{"location":"user-guide/getting-started/#error-certificate-validation-failed","title":"Error: \"Certificate validation failed\"","text":"<p>Soluci\u00f3n: 1. Verifica que los archivos .cer y .key sean v\u00e1lidos 2. Confirma que la contrase\u00f1a sea correcta 3. Verifica que no est\u00e9n vencidos</p> <pre><code># Verificar certificados\nfrom facturacion_mexico.utils.certificates import validate_certificates\nresult = validate_certificates()\nif not result['valid']:\n    print(f\"Error: {result['error']}\")\n</code></pre>"},{"location":"user-guide/getting-started/#error-en-addendas","title":"Error en Addendas","text":"<p>S\u00edntomas: Addenda no se genera autom\u00e1ticamente</p> <p>Soluci\u00f3n: 1. Verifica que el customer tenga FM Addenda Required marcado 2. Confirma que exista configuraci\u00f3n de addenda para ese cliente 3. Revisa logs de error</p> <pre><code># Debug addenda\nfrom facturacion_mexico.addendas.api import get_addenda_configuration\n\nresult = get_addenda_configuration(\"CUSTOMER-001\")\nprint(f\"Config found: {result['success']}\")\nif result['success']:\n    print(f\"Auto apply: {result['data']['auto_apply']}\")\n</code></pre>"},{"location":"user-guide/getting-started/#proximos-pasos","title":"\ud83d\udcda Pr\u00f3ximos Pasos","text":"<p>Una vez completada la configuraci\u00f3n b\u00e1sica:</p> <ol> <li>Configurar Multi-sucursal - Si manejas m\u00faltiples branches</li> <li>Configurar Addendas - Para clientes que requieren addendas espec\u00edficas  </li> <li>Troubleshooting Avanzado - Soluci\u00f3n de problemas complejos</li> </ol> <p>\u00a1Listo para Producci\u00f3n!</p> <p>Si todos los tests pasan y puedes generar CFDIs correctamente, tu sistema est\u00e1 listo para producci\u00f3n.</p> <p>Monitoreo</p> <p>Configura alertas para monitorear el estado de tus certificados y credenciales PAC.</p> <p>Respaldos</p> <p>Siempre mant\u00e9n respaldos de tus certificados SAT y configuraci\u00f3n PAC.</p>"},{"location":"user-guide/multisucursal/","title":"Multi-sucursal - Gu\u00eda de Usuario","text":"<p>Gu\u00eda completa para configurar y usar el sistema multi-sucursal.</p>"},{"location":"user-guide/multisucursal/#que-es-multi-sucursal","title":"\ud83c\udfe2 \u00bfQu\u00e9 es Multi-sucursal?","text":"<p>El sistema multi-sucursal permite gestionar m\u00faltiples branches de tu empresa con:</p> <ul> <li>Timbrado coordinado entre sucursales</li> <li>Selecci\u00f3n autom\u00e1tica del branch \u00f3ptimo</li> <li>Failover autom\u00e1tico en caso de fallas</li> <li>Balanceo de carga inteligente</li> </ul>"},{"location":"user-guide/multisucursal/#configuracion-inicial","title":"\u2699\ufe0f Configuraci\u00f3n Inicial","text":""},{"location":"user-guide/multisucursal/#1-habilitar-multi-sucursal","title":"1. Habilitar Multi-sucursal","text":"<p>En tu <code>site_config.json</code>:</p> <pre><code>{\n  \"multisucursal_enabled\": 1,\n  \"multisucursal_coordination\": 1,\n  \"branch_failover_enabled\": 1\n}\n</code></pre>"},{"location":"user-guide/multisucursal/#2-crear-branches","title":"2. Crear Branches","text":""},{"location":"user-guide/multisucursal/#branch-principal-matriz","title":"Branch Principal (Matriz)","text":"<ol> <li>Ve a Setup &gt; Facturaci\u00f3n M\u00e9xico &gt; Branches</li> <li>Clic en New Branch</li> <li>Completa los datos:</li> </ol> <pre><code>Branch Code: MATRIZ_01\nBranch Name: Casa Matriz\nIs Primary: \u2713 (marcado)\nPAC Provider: finkok\nStatus: Active\nCoordination Group: GRUPO_CENTRO\n</code></pre>"},{"location":"user-guide/multisucursal/#branches-secundarios","title":"Branches Secundarios","text":"<p>Repite el proceso para cada sucursal:</p> <pre><code>Branch Code: NORTE_01\nBranch Name: Sucursal Norte\nIs Primary: \u2717 (desmarcado)  \nPAC Provider: finkok\nStatus: Active\nCoordination Group: GRUPO_NORTE\n</code></pre>"},{"location":"user-guide/multisucursal/#3-configurar-credenciales-pac","title":"3. Configurar Credenciales PAC","text":"<p>Para cada branch, configura credenciales PAC independientes:</p> <pre><code>// En Branch configuration\n{\n  \"pac_credentials\": {\n    \"username\": \"user_sucursal_01\",\n    \"password\": \"pass_sucursal_01\",\n    \"test_mode\": false\n  }\n}\n</code></pre>"},{"location":"user-guide/multisucursal/#uso-diario","title":"\ud83d\udccb Uso Diario","text":""},{"location":"user-guide/multisucursal/#seleccion-automatica-de-branch","title":"Selecci\u00f3n Autom\u00e1tica de Branch","text":"<p>El sistema selecciona autom\u00e1ticamente el branch \u00f3ptimo basado en:</p> <ol> <li>Cliente espec\u00edfico: Preferencias configuradas</li> <li>Ubicaci\u00f3n geogr\u00e1fica: Proximidad del cliente</li> <li>Disponibilidad: Estado del PAC provider</li> <li>Carga actual: Balanceo de operaciones</li> </ol>"},{"location":"user-guide/multisucursal/#crear-factura-multi-sucursal","title":"Crear Factura Multi-sucursal","text":""},{"location":"user-guide/multisucursal/#proceso-normal","title":"Proceso Normal","text":"<ol> <li>Crear Sales Invoice normalmente</li> <li>El sistema autom\u00e1ticamente:</li> <li>Selecciona el branch \u00f3ptimo</li> <li>Configura credenciales PAC</li> <li>Genera CFDI con datos del branch</li> </ol>"},{"location":"user-guide/multisucursal/#override-manual","title":"Override Manual","text":"<p>Si necesitas forzar un branch espec\u00edfico:</p> <ol> <li>En Sales Invoice, ve a More &gt; Facturaci\u00f3n M\u00e9xico</li> <li>Selecciona Force Branch: <code>NORTE_01</code></li> <li>Submit normalmente</li> </ol>"},{"location":"user-guide/multisucursal/#monitorear-estado-de-branches","title":"Monitorear Estado de Branches","text":""},{"location":"user-guide/multisucursal/#dashboard-multi-sucursal","title":"Dashboard Multi-sucursal","text":"<p>Ve a Facturaci\u00f3n M\u00e9xico &gt; Multi-sucursal Dashboard:</p> <ul> <li>Branch Status: Estado actual de cada sucursal</li> <li>PAC Connectivity: Conectividad con proveedores</li> <li>Volume Distribution: Distribuci\u00f3n de carga</li> <li>Response Times: Tiempos de respuesta</li> </ul>"},{"location":"user-guide/multisucursal/#metricas-por-branch","title":"M\u00e9tricas por Branch","text":"<pre><code># Consultar m\u00e9tricas desde consola\nimport frappe\nfrom facturacion_mexico.multisucursal.metrics import get_branch_metrics\n\nmetrics = get_branch_metrics(\"NORTE_01\", days=7)\nprint(f\"CFDIs procesados: {metrics['total_invoices']}\")\nprint(f\"Tasa de \u00e9xito: {metrics['success_rate']}%\")\nprint(f\"Tiempo promedio: {metrics['avg_response_time']}ms\")\n</code></pre>"},{"location":"user-guide/multisucursal/#coordinacion-entre-branches","title":"\ud83d\udd04 Coordinaci\u00f3n entre Branches","text":""},{"location":"user-guide/multisucursal/#grupos-de-coordinacion","title":"Grupos de Coordinaci\u00f3n","text":"<p>Los branches se organizan en grupos para optimizar la coordinaci\u00f3n:</p> <pre><code>COORDINATION_GROUPS = {\n    \"GRUPO_NORTE\": {\n        \"branches\": [\"TIJUANA_01\", \"MONTERREY_01\", \"CHIHUAHUA_01\"],\n        \"primary\": \"MONTERREY_01\",\n        \"backup_priority\": [\"TIJUANA_01\", \"CHIHUAHUA_01\"]\n    },\n    \"GRUPO_CENTRO\": {\n        \"branches\": [\"MEXICO_01\", \"GUADALAJARA_01\", \"PUEBLA_01\"], \n        \"primary\": \"MEXICO_01\",\n        \"backup_priority\": [\"GUADALAJARA_01\", \"PUEBLA_01\"]\n    }\n}\n</code></pre>"},{"location":"user-guide/multisucursal/#algoritmo-de-seleccion","title":"Algoritmo de Selecci\u00f3n","text":"<pre><code>graph TD\n    A[Nueva Factura] --&gt; B{Cliente tiene&lt;br/&gt;branch preferido?}\n    B --&gt;|S\u00ed| C{Branch disponible?}\n    B --&gt;|No| D[Selecci\u00f3n geogr\u00e1fica]\n    C --&gt;|S\u00ed| E[Usar branch preferido]\n    C --&gt;|No| F[Buscar backup en grupo]\n    D --&gt; G{Branch geogr\u00e1fico&lt;br/&gt;disponible?}\n    G --&gt;|S\u00ed| H[Usar branch geogr\u00e1fico]\n    G --&gt;|No| F\n    F --&gt; I{Backup disponible?}\n    I --&gt;|S\u00ed| J[Usar backup]\n    I --&gt;|No| K[Usar branch primario]\n    E --&gt; L[Procesar CFDI]\n    H --&gt; L\n    J --&gt; L\n    K --&gt; L\n</code></pre>"},{"location":"user-guide/multisucursal/#manejo-de-failover","title":"\ud83d\udea8 Manejo de Failover","text":""},{"location":"user-guide/multisucursal/#deteccion-de-fallas","title":"Detecci\u00f3n de Fallas","text":"<p>El sistema monitorea continuamente:</p> <ul> <li>Conectividad PAC: Ping cada 30 segundos</li> <li>Respuesta de timbrado: Timeout &lt; 10 segundos</li> <li>Tasa de errores: M\u00e1ximo 5% en ventana de 5 minutos</li> </ul>"},{"location":"user-guide/multisucursal/#proceso-de-failover","title":"Proceso de Failover","text":"<p>Cuando se detecta una falla:</p> <ol> <li>Marcar branch como no disponible</li> <li>Seleccionar backup del mismo grupo</li> <li>Transferir operaciones pendientes</li> <li>Notificar a administradores</li> </ol>"},{"location":"user-guide/multisucursal/#recuperacion-automatica","title":"Recuperaci\u00f3n Autom\u00e1tica","text":"<pre><code># Configurar recuperaci\u00f3n autom\u00e1tica\nFAILOVER_CONFIG = {\n    \"auto_recovery\": True,\n    \"health_check_interval\": 30,  # segundos\n    \"recovery_threshold\": 3,      # checks exitosos consecutivos\n    \"max_retry_attempts\": 5\n}\n</code></pre>"},{"location":"user-guide/multisucursal/#reportes-y-analytics","title":"\ud83d\udcca Reportes y Analytics","text":""},{"location":"user-guide/multisucursal/#reporte-de-distribucion","title":"Reporte de Distribuci\u00f3n","text":"<p>Ve a Reports &gt; Facturaci\u00f3n M\u00e9xico &gt; Branch Distribution Report:</p> <ul> <li>CFDIs por branch por per\u00edodo</li> <li>Distribuci\u00f3n de clientes</li> <li>Volumen de facturaci\u00f3n</li> <li>M\u00e9tricas de performance</li> </ul>"},{"location":"user-guide/multisucursal/#analisis-de-failover","title":"An\u00e1lisis de Failover","text":"<pre><code># Generar reporte de failover\nfrom facturacion_mexico.multisucursal.reports import generate_failover_report\n\nreport = generate_failover_report(\n    from_date=\"2025-01-01\",\n    to_date=\"2025-01-31\"\n)\n\nprint(f\"Total failovers: {report['total_failovers']}\")\nprint(f\"Tiempo promedio de recuperaci\u00f3n: {report['avg_recovery_time']} segundos\")\nprint(f\"Branch m\u00e1s estable: {report['most_stable_branch']}\")\n</code></pre>"},{"location":"user-guide/multisucursal/#configuracion-avanzada","title":"\ud83d\udd27 Configuraci\u00f3n Avanzada","text":""},{"location":"user-guide/multisucursal/#politicas-de-seleccion","title":"Pol\u00edticas de Selecci\u00f3n","text":"<pre><code># Personalizar algoritmo de selecci\u00f3n\nSELECTION_POLICIES = {\n    \"geographic_priority\": True,     # Priorizar cercan\u00eda geogr\u00e1fica  \n    \"load_balancing\": True,          # Balancear carga entre branches\n    \"cost_optimization\": False,      # Optimizar por costo vs velocidad\n    \"client_affinity\": True,         # Mantener afinidad por cliente\n    \"peak_hour_routing\": True        # Ruteo especial en horas pico\n}\n</code></pre>"},{"location":"user-guide/multisucursal/#configuracion-por-cliente","title":"Configuraci\u00f3n por Cliente","text":"<pre><code># Configurar branch espec\u00edfico para cliente\ncustomer_doc = frappe.get_doc(\"Customer\", \"WALMART-001\")\ncustomer_doc.preferred_branch = \"NORTE_01\"\ncustomer_doc.backup_branches = [\"CENTRO_01\", \"SUR_01\"]\ncustomer_doc.save()\n</code></pre>"},{"location":"user-guide/multisucursal/#alertas-y-notificaciones","title":"Alertas y Notificaciones","text":"<pre><code># Configurar alertas\nALERT_CONFIG = {\n    \"branch_down\": {\n        \"enabled\": True,\n        \"recipients\": [\"admin@empresa.com\", \"operaciones@empresa.com\"],\n        \"channels\": [\"email\", \"slack\"]\n    },\n    \"high_error_rate\": {\n        \"enabled\": True,\n        \"threshold\": 5,  # porcentaje\n        \"time_window\": 300  # segundos\n    }\n}\n</code></pre>"},{"location":"user-guide/multisucursal/#troubleshooting","title":"\ud83d\udee0\ufe0f Troubleshooting","text":""},{"location":"user-guide/multisucursal/#branch-no-responde","title":"Branch No Responde","text":"<p>S\u00edntomas: - Timeouts en timbrado - Errores de conectividad PAC</p> <p>Soluci\u00f3n: 1. Verificar conectividad de red 2. Revisar credenciales PAC 3. Comprobar estado del servicio PAC</p> <pre><code># Diagnosticar branch\nfrom facturacion_mexico.multisucursal.diagnostics import diagnose_branch\n\nresult = diagnose_branch(\"NORTE_01\")\nprint(f\"Status: {result['status']}\")\nprint(f\"Issues: {result['issues']}\")\nprint(f\"Recommendations: {result['recommendations']}\")\n</code></pre>"},{"location":"user-guide/multisucursal/#failover-no-funciona","title":"Failover No Funciona","text":"<p>S\u00edntomas: - Fallas no se detectan autom\u00e1ticamente - Backup branches no se activan</p> <p>Soluci\u00f3n: 1. Verificar configuraci\u00f3n de health checks 2. Revisar logs de coordination service 3. Comprobar configuraci\u00f3n de grupos</p> <pre><code># Revisar logs de coordinaci\u00f3n\ntail -f logs/multisucursal-coordination.log\n\n# Forzar health check manual\nbench --site tu-sitio.local execute facturacion_mexico.multisucursal.coordination.force_health_check\n</code></pre>"},{"location":"user-guide/multisucursal/#distribucion-desbalanceada","title":"Distribuci\u00f3n Desbalanceada","text":"<p>S\u00edntomas: - Un branch procesa mucho m\u00e1s que otros - Tiempos de respuesta dispares</p> <p>Soluci\u00f3n: 1. Revisar algoritmo de balanceo 2. Ajustar pesos de distribuci\u00f3n 3. Verificar capacidad de branches</p> <pre><code># Ajustar pesos de balanceo\nbranch_weights = {\n    \"MATRIZ_01\": 0.4,    # 40% de la carga\n    \"NORTE_01\": 0.3,     # 30% de la carga  \n    \"SUR_01\": 0.3        # 30% de la carga\n}\n\nfrappe.db.set_value(\"Branch Settings\", None, \"load_distribution_weights\", \n                   json.dumps(branch_weights))\n</code></pre> <p>Sistema Resiliente</p> <p>El sistema multi-sucursal garantiza 99.9% de disponibilidad con failover autom\u00e1tico.</p> <p>Optimizaci\u00f3n</p> <p>Agrupa branches geogr\u00e1ficamente cercanos para minimizar latencia en coordinaci\u00f3n.</p> <p>Monitoreo Continuo</p> <p>Configura alertas proactivas para detectar problemas antes que afecten usuarios.</p>"},{"location":"user-guide/troubleshooting/","title":"Troubleshooting - Soluci\u00f3n de Problemas","text":"<p>Gu\u00eda completa para resolver problemas comunes del sistema de facturaci\u00f3n.</p>"},{"location":"user-guide/troubleshooting/#problemas-de-timbrado","title":"\ud83d\udea8 Problemas de Timbrado","text":""},{"location":"user-guide/troubleshooting/#error-pac-provider-not-configured","title":"Error: \"PAC Provider Not Configured\"","text":"<p>S\u00edntomas: - Error al hacer submit de Sales Invoice - Mensaje: \"No PAC provider configured\"</p> <p>Soluci\u00f3n:</p> <ol> <li>Verificar configuraci\u00f3n PAC:    <pre><code>bench --site tu-sitio.local console\n</code></pre></li> </ol> <pre><code>import frappe\nprint(f\"PAC Provider: {frappe.conf.get('pac_provider')}\")\nprint(f\"PAC Username: {frappe.conf.get('pac_username')}\")\nprint(f\"Test Mode: {frappe.conf.get('pac_test_mode')}\")\n</code></pre> <ol> <li> <p>Configurar en site_config.json:    <pre><code>{\n  \"pac_provider\": \"finkok\",\n  \"pac_username\": \"tu_usuario\",\n  \"pac_password\": \"tu_password\",\n  \"pac_test_mode\": 1\n}\n</code></pre></p> </li> <li> <p>Reiniciar servicios:    <pre><code>bench restart\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#error-certificate-validation-failed","title":"Error: \"Certificate Validation Failed\"","text":"<p>S\u00edntomas: - Timbrado falla con error de certificado - XML se genera pero no se timbre</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Verificar certificados:    <pre><code>from facturacion_mexico.utils.certificates import validate_certificates\n\nresult = validate_certificates()\nprint(f\"V\u00e1lido: {result['valid']}\")\nprint(f\"Error: {result.get('error')}\")\nprint(f\"Expira: {result.get('expires_on')}\")\n</code></pre></p> </li> <li> <p>Re-subir certificados:</p> </li> <li>Ve a Setup &gt; Facturaci\u00f3n M\u00e9xico &gt; Certificados SAT</li> <li>Sube nuevamente los archivos .cer y .key</li> <li> <p>Ingresa la contrase\u00f1a correcta</p> </li> <li> <p>Verificar permisos:    <pre><code># Verificar que los archivos sean legibles\nls -la sites/tu-sitio.local/private/files/\nchmod 644 sites/tu-sitio.local/private/files/*.cer\nchmod 600 sites/tu-sitio.local/private/files/*.key\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#error-invalid-xml-structure","title":"Error: \"Invalid XML Structure\"","text":"<p>S\u00edntomas: - XML se genera con errores de estructura - PAC rechaza el XML por formato inv\u00e1lido</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Validar datos de company:    <pre><code>company = frappe.get_doc(\"Company\", \"Tu Empresa\")\nprint(f\"RFC: {company.tax_id}\")\nprint(f\"R\u00e9gimen Fiscal: {company.default_tax_regime}\")\nprint(f\"C\u00f3digo Postal: {company.zip_code}\")\n</code></pre></p> </li> <li> <p>Verificar catalogos SAT:    <pre><code>bench --site tu-sitio.local execute facturacion_mexico.catalogos_sat.sync_all_catalogs\n</code></pre></p> </li> <li> <p>Validar XML manualmente:    <pre><code>from facturacion_mexico.cfdi.xml_validator import validate_cfdi_xml\n\ninvoice = frappe.get_doc(\"Sales Invoice\", \"SINV-00001\")\nresult = validate_cfdi_xml(invoice.cfdi_xml)\n\nif not result['valid']:\n    for error in result['errors']:\n        print(f\"Error: {error}\")\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#problemas-multi-sucursal","title":"\ud83c\udfe2 Problemas Multi-sucursal","text":""},{"location":"user-guide/troubleshooting/#branch-no-responde","title":"Branch No Responde","text":"<p>S\u00edntomas: - Timeouts al procesar facturas - Branch marcado como \"Not Available\"</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Verificar conectividad:    <pre><code>from facturacion_mexico.multisucursal.diagnostics import test_branch_connectivity\n\nresult = test_branch_connectivity(\"NORTE_01\")\nprint(f\"Status: {result['status']}\")\nprint(f\"Response Time: {result['response_time']}ms\")\nprint(f\"PAC Available: {result['pac_available']}\")\n</code></pre></p> </li> <li> <p>Revisar credenciales PAC del branch:    <pre><code>branch = frappe.get_doc(\"Branch\", \"NORTE_01\")\n\n# Verificar configuraci\u00f3n (sin mostrar password)\nprint(f\"PAC Provider: {branch.pac_provider}\")\nprint(f\"Username configured: {bool(branch.pac_username)}\")\nprint(f\"Status: {branch.status}\")\n</code></pre></p> </li> <li> <p>Forzar health check:    <pre><code>bench --site tu-sitio.local execute facturacion_mexico.multisucursal.coordination.force_health_check --args \"['NORTE_01']\"\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#failover-no-funciona","title":"Failover No Funciona","text":"<p>S\u00edntomas: - Falla un branch pero el sistema no cambia autom\u00e1ticamente - Errores contin\u00faan en lugar de usar backup</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Verificar configuraci\u00f3n de failover:    <pre><code>import frappe\n\n# Verificar configuraci\u00f3n global\nfailover_enabled = frappe.conf.get('branch_failover_enabled')\nprint(f\"Failover habilitado: {failover_enabled}\")\n\n# Verificar grupos de coordinaci\u00f3n\nfrom facturacion_mexico.multisucursal.coordination import get_coordination_groups\ngroups = get_coordination_groups()\nprint(f\"Grupos configurados: {list(groups.keys())}\")\n</code></pre></p> </li> <li> <p>Revisar logs de coordinaci\u00f3n:    <pre><code>tail -f logs/frappe.log | grep \"multisucursal\"\n</code></pre></p> </li> <li> <p>Configurar backup branches:    <pre><code># Configurar backups para un grupo\ngroup_config = {\n    \"GRUPO_NORTE\": {\n        \"primary\": \"MONTERREY_01\",\n        \"backups\": [\"TIJUANA_01\", \"CHIHUAHUA_01\"],\n        \"failover_threshold\": 3  # errores consecutivos\n    }\n}\n\nfrappe.db.set_value(\"Branch Settings\", None, \"coordination_groups\", \n                   json.dumps(group_config))\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#problemas-de-addendas","title":"\ud83d\udcc4 Problemas de Addendas","text":""},{"location":"user-guide/troubleshooting/#addenda-no-se-genera","title":"Addenda No Se Genera","text":"<p>S\u00edntomas: - Campo <code>addenda_xml</code> permanece vac\u00edo - No aparece addenda en el PDF</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Verificar configuraci\u00f3n del cliente:    <pre><code>customer = frappe.get_doc(\"Customer\", \"WALMART-001\")\n\nprint(f\"Addenda Required: {customer.get('fm_addenda_required')}\")\nprint(f\"Addenda Type: {customer.get('addenda_type')}\")\nprint(f\"Auto Apply: {customer.get('addenda_auto_apply')}\")\n</code></pre></p> </li> <li> <p>Verificar tipo de addenda:    <pre><code>if customer.addenda_type:\n    addenda_type = frappe.get_doc(\"Addenda Type\", customer.addenda_type)\n    print(f\"Template File: {addenda_type.template_file}\")\n    print(f\"Auto Apply: {addenda_type.auto_apply}\")\n    print(f\"Required Fields: {addenda_type.required_fields}\")\n</code></pre></p> </li> <li> <p>Verificar template file:    <pre><code># Verificar que el template existe\nls -la addendas/templates/walmart_mx.xml\n\n# Verificar permisos\nchmod 644 addendas/templates/*.xml\n</code></pre></p> </li> <li> <p>Generar manualmente:    <pre><code>from facturacion_mexico.addendas.generator import generate_addenda_for_invoice\n\ninvoice = frappe.get_doc(\"Sales Invoice\", \"SINV-00001\")\nresult = generate_addenda_for_invoice(invoice)\n\nif result['success']:\n    print(\"Addenda generada exitosamente\")\nelse:\n    print(f\"Error: {result['error']}\")\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#error-de-validacion-en-addenda","title":"Error de Validaci\u00f3n en Addenda","text":"<p>S\u00edntomas: - Addenda se genera pero falla validaci\u00f3n - Errores de formato XML</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Validar XML estructura:    <pre><code>from facturacion_mexico.addendas.validator import validate_addenda_xml\nimport xml.etree.ElementTree as ET\n\ntry:\n    ET.fromstring(invoice.addenda_xml)\n    print(\"XML bien formado\")\nexcept ET.ParseError as e:\n    print(f\"Error XML: {e}\")\n</code></pre></p> </li> <li> <p>Verificar campos requeridos:    <pre><code>from facturacion_mexico.addendas.validator import check_required_fields\n\ninvoice = frappe.get_doc(\"Sales Invoice\", \"SINV-00001\") \nmissing_fields = check_required_fields(invoice, \"WALMART_MX\")\n\nif missing_fields:\n    print(f\"Campos faltantes: {missing_fields}\")\n</code></pre></p> </li> <li> <p>Debug del template:    <pre><code># Verificar datos disponibles para el template\nfrom frappe.utils.jinja import get_jenv\n\njenv = get_jenv()\ntemplate = jenv.get_template(\"walmart_mx.xml\")\n\n# Context de datos\ncontext = {\n    'invoice_number': invoice.name,\n    'purchase_order': invoice.po_no,\n    'vendor_number': invoice.supplier_invoice,\n    # ... otros campos\n}\n\ntry:\n    rendered = template.render(**context)\n    print(\"Template renderizado exitosamente\")\nexcept Exception as e:\n    print(f\"Error en template: {e}\")\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#problemas-de-catalogos-sat","title":"\ud83d\udcca Problemas de Catalogos SAT","text":""},{"location":"user-guide/troubleshooting/#catalogos-desactualizados","title":"Catalogos Desactualizados","text":"<p>S\u00edntomas: - C\u00f3digos SAT no encontrados - Errores de validaci\u00f3n por catalogos obsoletos</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Sincronizar catalogos:    <pre><code># Sincronizar todos los catalogos\nbench --site tu-sitio.local execute facturacion_mexico.catalogos_sat.sync_all_catalogs\n\n# Sincronizar cat\u00e1logo espec\u00edfico\nbench --site tu-sitio.local execute facturacion_mexico.catalogos_sat.sync_regimen_fiscal\n</code></pre></p> </li> <li> <p>Verificar \u00faltima sincronizaci\u00f3n:    <pre><code>from frappe.utils import get_datetime\n\n# Verificar reg\u00edmenes fiscales\nlast_sync = frappe.db.get_value(\"Regimen Fiscal SAT\", \n                               filters={}, \n                               fieldname=\"modified\", \n                               order_by=\"modified desc\")\n\nprint(f\"\u00daltima sincronizaci\u00f3n: {last_sync}\")\n\n# Verificar cantidad de registros\ncount = frappe.db.count(\"Regimen Fiscal SAT\")\nprint(f\"Reg\u00edmenes disponibles: {count}\")\n</code></pre></p> </li> <li> <p>Forzar descarga manual:    <pre><code>from facturacion_mexico.catalogos_sat.downloader import download_sat_catalog\n\n# Descargar cat\u00e1logo espec\u00edfico\nresult = download_sat_catalog(\"regimen_fiscal\")\nprint(f\"Descargados: {result['count']} registros\")\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#items-sin-codigos-sat","title":"Items Sin C\u00f3digos SAT","text":"<p>S\u00edntomas: - Error: \"Item code SAT not found\" - Factura no se puede timbrar</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Configurar c\u00f3digos SAT en items:    <pre><code># Buscar items sin c\u00f3digo SAT\nitems_without_sat = frappe.db.sql(\"\"\"\n    SELECT name, item_name \n    FROM `tabItem` \n    WHERE sat_item_code IS NULL OR sat_item_code = ''\n    LIMIT 10\n\"\"\", as_dict=True)\n\nfor item in items_without_sat:\n    print(f\"Item sin SAT: {item.name} - {item.item_name}\")\n</code></pre></p> </li> <li> <p>Asignar c\u00f3digos SAT autom\u00e1ticamente:    <pre><code># Script para asignar c\u00f3digos SAT por descripci\u00f3n\ndef auto_assign_sat_codes():\n    items = frappe.get_all(\"Item\", \n                          filters={\"sat_item_code\": [\"in\", [None, \"\"]]},\n                          fields=[\"name\", \"item_name\", \"description\"])\n\n    for item in items:\n        # L\u00f3gica para encontrar c\u00f3digo SAT apropiado\n        sat_code = find_best_sat_code(item.item_name)\n\n        if sat_code:\n            frappe.db.set_value(\"Item\", item.name, \"sat_item_code\", sat_code)\n            print(f\"Asignado {sat_code} a {item.name}\")\n</code></pre></p> </li> <li> <p>Usar c\u00f3digo SAT gen\u00e9rico temporalmente:    <pre><code># Asignar c\u00f3digo gen\u00e9rico a items problem\u00e1ticos\ngeneric_code = \"01010101\"  # C\u00f3digo gen\u00e9rico SAT\n\nfrappe.db.sql(\"\"\"\n    UPDATE `tabItem` \n    SET sat_item_code = %s \n    WHERE sat_item_code IS NULL OR sat_item_code = ''\n\"\"\", (generic_code,))\n\nprint(\"C\u00f3digos gen\u00e9ricos asignados\")\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#problemas-de-performance","title":"\ud83d\udd27 Problemas de Performance","text":""},{"location":"user-guide/troubleshooting/#timbrado-lento","title":"Timbrado Lento","text":"<p>S\u00edntomas: - Submit de facturas toma m\u00e1s de 10 segundos - Timeouts en timbrado</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Monitorear tiempos:    <pre><code>import time\nfrom functools import wraps\n\ndef time_function(func):\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        start = time.time()\n        result = func(*args, **kwargs)\n        end = time.time()\n        print(f\"{func.__name__} tom\u00f3 {end - start:.2f} segundos\")\n        return result\n    return wrapper\n\n# Aplicar a funci\u00f3n de timbrado\n@time_function\ndef timbrar_factura(invoice):\n    # L\u00f3gica de timbrado\n    pass\n</code></pre></p> </li> <li> <p>Optimizar consultas:    <pre><code># Verificar queries lentas\nfrappe.db.debug = True\n\n# Procesar factura\ninvoice.submit()\n\n# Ver log de queries\nfor query in frappe.db.get_query_log():\n    if query['time'] &gt; 1.0:  # Queries &gt; 1 segundo\n        print(f\"Query lenta: {query['query'][:100]}... ({query['time']:.2f}s)\")\n</code></pre></p> </li> <li> <p>Configurar cache:    <pre><code># Cachear catalogos SAT frecuentemente usados\n@frappe.cache.memoize()\ndef get_sat_regimen_fiscal():\n    return frappe.get_all(\"Regimen Fiscal SAT\", \n                        fields=[\"codigo\", \"descripcion\"])\n\n# Usar cache en lugar de query directa\nregimenes = get_sat_regimen_fiscal()\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#memoria-alta","title":"Memoria Alta","text":"<p>S\u00edntomas: - Proceso Frappe consume mucha RAM - Server se ralentiza con el tiempo</p> <p>Soluci\u00f3n:</p> <ol> <li> <p>Monitorear uso de memoria:    <pre><code>import psutil\nimport os\n\nprocess = psutil.Process(os.getpid())\nmemory_info = process.memory_info()\n\nprint(f\"RSS: {memory_info.rss / 1024 / 1024:.2f} MB\")\nprint(f\"VMS: {memory_info.vms / 1024 / 1024:.2f} MB\")\n</code></pre></p> </li> <li> <p>Limpiar cache peri\u00f3dicamente:    <pre><code># Limpiar cache manualmente\nbench --site tu-sitio.local clear-cache\n\n# Configurar limpieza autom\u00e1tica\nbench --site tu-sitio.local set-config clear_cache_interval 3600  # cada hora\n</code></pre></p> </li> <li> <p>Optimizar consultas masivas:    <pre><code># En lugar de cargar todos los registros\n# invoices = frappe.get_all(\"Sales Invoice\")  # \u274c Malo\n\n# Usar paginaci\u00f3n\ndef process_invoices_batch():\n    start = 0\n    page_size = 100\n\n    while True:\n        invoices = frappe.get_all(\"Sales Invoice\", \n                                start=start, \n                                page_length=page_size)\n\n        if not invoices:\n            break\n\n        for invoice in invoices:\n            process_invoice(invoice)\n\n        start += page_size\n</code></pre></p> </li> </ol>"},{"location":"user-guide/troubleshooting/#herramientas-de-debugging","title":"\ud83d\udd0d Herramientas de Debugging","text":""},{"location":"user-guide/troubleshooting/#logs-detallados","title":"Logs Detallados","text":"<pre><code># Habilitar logging detallado\nimport logging\n\n# Para m\u00f3dulo espec\u00edfico\nlogging.getLogger('facturacion_mexico').setLevel(logging.DEBUG)\n\n# Para logging global\nfrappe.log_error(\"Debug info\", \"Debug Category\")\n</code></pre>"},{"location":"user-guide/troubleshooting/#console-commands","title":"Console Commands","text":"<pre><code># Informaci\u00f3n del sistema\nbench --site tu-sitio.local console\n</code></pre> <pre><code># Commands \u00fatiles en consola\nimport frappe\n\n# Ver configuraci\u00f3n actual\nprint(frappe.conf)\n\n# Ver apps instaladas\nprint(frappe.get_installed_apps())\n\n# Ver site config\nprint(frappe.get_site_config())\n\n# Informaci\u00f3n de la base de datos\nprint(f\"DB: {frappe.db.db_name}\")\nprint(f\"Usuario: {frappe.session.user}\")\n</code></pre>"},{"location":"user-guide/troubleshooting/#health-check-script","title":"Health Check Script","text":"<pre><code>def system_health_check():\n    \"\"\"Script completo de health check.\"\"\"\n\n    checks = {\n        \"PAC Configuration\": check_pac_config(),\n        \"Certificates\": check_certificates(),\n        \"SAT Catalogs\": check_sat_catalogs(),\n        \"Branches\": check_branches(),\n        \"Templates\": check_templates(),\n        \"Performance\": check_performance()\n    }\n\n    print(\"\\n=== HEALTH CHECK RESULTS ===\")\n    for check_name, result in checks.items():\n        status = \"\u2705 PASS\" if result['status'] else \"\u274c FAIL\"\n        print(f\"{check_name}: {status}\")\n        if not result['status']:\n            print(f\"  Error: {result['error']}\")\n\n    return all(check['status'] for check in checks.values())\n\n# Ejecutar health check\nhealth_ok = system_health_check()\nprint(f\"\\nSistema saludable: {'\u2705 S\u00ed' if health_ok else '\u274c No'}\")\n</code></pre> <p>Logging Proactivo</p> <p>Habilita logging detallado durante desarrollo para detectar problemas temprano.</p> <p>Performance</p> <p>Monitorea regularmente el performance del sistema, especialmente en timbrado masivo.</p> <p>Support</p> <p>Si ninguna soluci\u00f3n funciona, revisa los logs de sistema y contacta soporte t\u00e9cnico con informaci\u00f3n espec\u00edfica del error.</p>"}]}