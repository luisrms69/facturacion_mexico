{
  "actions": [],
  "allow_rename": 1,
  "autoname": "naming_series:",
  "creation": "2025-07-17 19:45:00.000000",
  "doctype": "DocType",
  "editable_grid": 1,
  "engine": "InnoDB",
  "is_submittable": 1,
  "field_order": [
    "naming_series",
    "sales_invoice",
    "company",
    "customer",
    "status",
    "column_break_payment_methods",
    "fm_payment_method_sat",
    "fm_forma_pago_timbrado",
    "section_break_datos_facturacion",
    "fm_cp_cliente",
    "fm_email_facturacion",
    "fm_rfc_cliente",
    "fm_tax_system",
    "column_break_datos_facturacion",
    "fm_direccion_principal_link",
    "fm_direccion_principal_display",
    "column_break_basic",
    "fecha_timbrado",
    "section_break_facturapi",
    "facturapi_id",
    "uuid",
    "fm_cfdi_use",
    "fm_fiscal_status",
    "fm_serie_folio",
    "fm_lugar_expedicion",
    "column_break_fiscal",
    "serie",
    "folio",
    "total_fiscal",
    "section_break_archivos",
    "pdf_file",
    "xml_file",
    "section_break_cancelacion",
    "cancellation_reason",
    "cancellation_date",
    "section_break_sistema_resiliente",
    "fm_sub_status",
    "fm_document_type",
    "fm_last_pac_sync",
    "fm_sync_status",
    "column_break_resiliente",
    "fm_sync_error",
    "fm_manual_override",
    "fm_override_reason",
    "fm_override_by",
    "fm_override_timestamp",
    "section_break_urls_archivos",
    "fm_xml_url",
    "fm_pdf_url",
    "fm_last_response_log",
    "section_break_historial_facturapi",
    "facturapi_response_history"
  ],
  "fields": [
    {
      "fieldname": "naming_series",
      "fieldtype": "Select",
      "label": "Serie de Numeración",
      "options": "FFMX-.YYYY.-",
      "reqd": 1
    },
    {
      "fieldname": "sales_invoice",
      "fieldtype": "Link",
      "in_list_view": 1,
      "label": "Factura de Venta",
      "options": "Sales Invoice",
      "reqd": 1
    },
    {
      "fieldname": "company",
      "fieldtype": "Link",
      "in_list_view": 1,
      "label": "Empresa Vendedora",
      "options": "Company",
      "read_only": 1,
      "reqd": 1
    },
    {
      "fieldname": "customer",
      "fieldtype": "Link",
      "in_list_view": 1,
      "label": "Cliente",
      "options": "Customer",
      "reqd": 1
    },
    {
      "depends_on": "eval:doc.customer && doc.sales_invoice",
      "fieldname": "customer_fiscal_warning",
      "fieldtype": "HTML",
      "label": "Aviso Cliente Fiscal",
      "options": "<div id=\"customer-fiscal-warning\" style=\"display: none;\"></div>"
    },
    {
      "fieldname": "column_break_basic",
      "fieldtype": "Column Break"
    },
    {
      "default": "draft",
      "fieldname": "status",
      "fieldtype": "Data",
      "in_list_view": 1,
      "label": "Estado",
      "read_only": 1,
      "reqd": 1
    },
    {
      "fieldname": "column_break_payment_methods",
      "fieldtype": "Column Break"
    },
    {
      "fieldname": "fm_payment_method_sat",
      "fieldtype": "Select",
      "label": "Método de Pago SAT",
      "options": "PUE\nPPD"
    },
    {
      "fieldname": "fm_forma_pago_timbrado",
      "fieldtype": "Link",
      "label": "Forma de Pago para Timbrado",
      "options": "Mode of Payment"
    },
    {
      "fieldname": "fecha_timbrado",
      "fieldtype": "Datetime",
      "label": "Fecha de Timbrado",
      "read_only": 1
    },
    {
      "fieldname": "section_break_facturapi",
      "fieldtype": "Section Break",
      "label": "Información FacturAPI"
    },
    {
      "description": "ID retornado por FacturAPI.io",
      "fieldname": "facturapi_id",
      "fieldtype": "Data",
      "label": "FacturAPI ID",
      "read_only": 1
    },
    {
      "description": "UUID fiscal del SAT",
      "fieldname": "uuid",
      "fieldtype": "Data",
      "in_list_view": 1,
      "label": "UUID Fiscal",
      "read_only": 1
    },
    {
      "fieldname": "fm_cfdi_use",
      "fieldtype": "Link",
      "label": "Uso del CFDI",
      "options": "Uso CFDI SAT"
    },
    {
      "default": "Pendiente",
      "description": "Estado fiscal calculado automáticamente basado en respuestas de FacturAPI",
      "fieldname": "fm_fiscal_status",
      "fieldtype": "Select",
      "in_list_view": 1,
      "label": "Estado Fiscal",
      "options": "Pendiente\nTimbrada\nCancelada\nError\nSolicitud Cancelación",
      "read_only": 1
    },
    {
      "fieldname": "fm_serie_folio",
      "fieldtype": "Data",
      "label": "Serie y Folio"
    },
    {
      "fieldname": "fm_lugar_expedicion",
      "fieldtype": "Data",
      "label": "Lugar de Expedición"
    },
    {
      "fieldname": "column_break_fiscal",
      "fieldtype": "Column Break"
    },
    {
      "description": "Serie de la factura fiscal",
      "fieldname": "serie",
      "fieldtype": "Data",
      "label": "Serie",
      "read_only": 1
    },
    {
      "description": "Folio de la factura fiscal",
      "fieldname": "folio",
      "fieldtype": "Data",
      "label": "Folio",
      "read_only": 1
    },
    {
      "description": "Total de la factura fiscal",
      "fieldname": "total_fiscal",
      "fieldtype": "Currency",
      "label": "Total Fiscal",
      "read_only": 1
    },
    {
      "fieldname": "section_break_archivos",
      "fieldtype": "Section Break",
      "label": "Archivos Fiscales"
    },
    {
      "description": "Archivo PDF de la factura",
      "fieldname": "pdf_file",
      "fieldtype": "Attach",
      "label": "Archivo PDF",
      "read_only": 1
    },
    {
      "description": "Archivo XML de la factura",
      "fieldname": "xml_file",
      "fieldtype": "Attach",
      "label": "Archivo XML",
      "read_only": 1
    },
    {
      "fieldname": "section_break_cancelacion",
      "fieldtype": "Section Break",
      "label": "Información de Cancelación"
    },
    {
      "fieldname": "cancellation_reason",
      "fieldtype": "Select",
      "label": "Motivo de Cancelación",
      "options": "01 - Comprobantes emitidos con errores con relación\n02 - Comprobantes emitidos con errores sin relación\n03 - No se llevó a cabo la operación\n04 - Operación nominativa relacionada en la factura global"
    },
    {
      "fieldname": "cancellation_date",
      "fieldtype": "Datetime",
      "label": "Fecha de Cancelación",
      "read_only": 1
    },
    {
      "fieldname": "section_break_historial_facturapi",
      "fieldtype": "Section Break",
      "label": "Historial FacturAPI"
    },
    {
      "depends_on": "eval:false",
      "fieldname": "facturapi_response_history",
      "fieldtype": "Table",
      "label": "Historial de Respuestas (DEPRECADO)",
      "options": "FacturAPI Response Item",
      "read_only": 1
    },
    {
      "fieldname": "section_break_datos_facturacion",
      "fieldtype": "Section Break",
      "label": "Datos de Facturación"
    },
    {
      "fieldname": "fm_cp_cliente",
      "fieldtype": "Data",
      "label": "CP Cliente",
      "read_only": 1,
      "description": "Código postal desde dirección principal del cliente"
    },
    {
      "fieldname": "fm_email_facturacion",
      "fieldtype": "Data",
      "label": "Email Facturación",
      "read_only": 1,
      "description": "Email desde dirección principal del cliente"
    },
    {
      "fieldname": "fm_rfc_cliente",
      "fieldtype": "Data",
      "label": "RFC Cliente",
      "read_only": 1,
      "description": "RFC desde Tax ID del cliente"
    },
    {
      "fieldname": "fm_tax_system",
      "fieldtype": "Data",
      "label": "Régimen Fiscal (Código)",
      "read_only": 1,
      "description": "Código del régimen fiscal para FacturAPI (ej: 601). Se obtiene automáticamente desde Tax Category del cliente"
    },
    {
      "fieldname": "column_break_datos_facturacion",
      "fieldtype": "Column Break"
    },
    {
      "fieldname": "fm_direccion_principal_link",
      "fieldtype": "Link",
      "label": "Dirección Principal",
      "options": "Address",
      "read_only": 1,
      "description": "Link a la dirección principal para edición"
    },
    {
      "fieldname": "fm_direccion_principal_display",
      "fieldtype": "Small Text",
      "label": "Dirección Completa",
      "read_only": 1,
      "description": "Dirección principal formateada"
    },
    {
      "fieldname": "section_break_sistema_resiliente",
      "fieldtype": "Section Break",
      "label": "Sistema Resiliente"
    },
    {
      "fieldname": "fm_sub_status",
      "fieldtype": "Data",
      "label": "Sub-Estado",
      "description": "Detalle adicional del estado fiscal",
      "allow_on_submit": 1,
      "read_only": 1
    },
    {
      "fieldname": "fm_document_type",
      "fieldtype": "Select",
      "label": "Tipo de Documento",
      "options": "invoice\nereceipt\ncomplement\nglobal\npayroll",
      "default": "invoice",
      "allow_on_submit": 1,
      "reqd": 1
    },
    {
      "fieldname": "fm_last_pac_sync",
      "fieldtype": "Datetime",
      "label": "Última Sincronización PAC",
      "description": "Última sincronización exitosa con PAC",
      "allow_on_submit": 1,
      "read_only": 1
    },
    {
      "fieldname": "fm_sync_status",
      "fieldtype": "Select",
      "label": "Estado de Sincronización",
      "options": "synced\npending\nerror",
      "default": "pending",
      "allow_on_submit": 1,
      "read_only": 1
    },
    {
      "fieldname": "column_break_resiliente",
      "fieldtype": "Column Break"
    },
    {
      "fieldname": "fm_sync_error",
      "fieldtype": "Text",
      "label": "Error de Sincronización",
      "description": "Último error de sincronización",
      "allow_on_submit": 1,
      "read_only": 1
    },
    {
      "fieldname": "fm_manual_override",
      "fieldtype": "Check",
      "label": "Override Manual",
      "description": "True si admin forzó estado manualmente",
      "allow_on_submit": 1,
      "default": 0
    },
    {
      "fieldname": "fm_override_reason",
      "fieldtype": "Text",
      "label": "Razón del Override",
      "description": "Razón del override manual",
      "allow_on_submit": 1,
      "depends_on": "eval:doc.fm_manual_override"
    },
    {
      "fieldname": "fm_override_by",
      "fieldtype": "Link",
      "label": "Override Realizado Por",
      "options": "User",
      "description": "Usuario que realizó el override manual",
      "allow_on_submit": 1,
      "read_only": 1,
      "depends_on": "eval:doc.fm_manual_override"
    },
    {
      "fieldname": "fm_override_timestamp",
      "fieldtype": "Datetime",
      "label": "Fecha de Override",
      "description": "Cuándo se realizó el override manual",
      "allow_on_submit": 1,
      "read_only": 1,
      "depends_on": "eval:doc.fm_manual_override"
    },
    {
      "fieldname": "section_break_urls_archivos",
      "fieldtype": "Section Break",
      "label": "URLs y Referencias"
    },
    {
      "fieldname": "fm_xml_url",
      "fieldtype": "Data",
      "label": "URL del XML",
      "description": "Link directo al archivo XML",
      "allow_on_submit": 1,
      "read_only": 1
    },
    {
      "fieldname": "fm_pdf_url",
      "fieldtype": "Data",
      "label": "URL del PDF",
      "description": "Link directo al archivo PDF",
      "allow_on_submit": 1,
      "read_only": 1
    },
    {
      "fieldname": "fm_last_response_log",
      "fieldtype": "Link",
      "label": "Último Log de Respuesta",
      "options": "FacturAPI Response Log",
      "description": "Referencia al último log de FacturAPI",
      "allow_on_submit": 1,
      "read_only": 1
    }
  ],
  "index_web_pages_for_search": 1,
  "links": [],
  "modified": "2025-07-17 19:45:00.000000",
  "modified_by": "Administrator",
  "module": "Facturacion Fiscal",
  "name": "Factura Fiscal Mexico",
  "naming_rule": "By \"Naming Series\" field",
  "owner": "Administrator",
  "permissions": [
    {
      "create": 1,
      "delete": 1,
      "email": 1,
      "export": 1,
      "print": 1,
      "read": 1,
      "report": 1,
      "role": "Accounts Manager",
      "share": 1,
      "write": 1
    },
    {
      "create": 1,
      "email": 1,
      "export": 1,
      "print": 1,
      "read": 1,
      "report": 1,
      "role": "Accounts User",
      "share": 1,
      "write": 1
    },
    {
      "create": 1,
      "delete": 1,
      "email": 1,
      "export": 1,
      "print": 1,
      "read": 1,
      "report": 1,
      "role": "System Manager",
      "share": 1,
      "write": 1
    }
  ],
  "sort_field": "modified",
  "sort_order": "DESC",
  "states": [],
  "title_field": "sales_invoice",
  "track_changes": 1
}
